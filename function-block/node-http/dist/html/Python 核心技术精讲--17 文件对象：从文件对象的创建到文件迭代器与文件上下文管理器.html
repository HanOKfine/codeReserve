<!doctype html>
<html lang="zh_CN">

    

    

    
    
    
    <head>
        
        <title>17 文件对象：从文件对象的创建到文件迭代器与文件上下文管理器</title>
        
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="description" content="揭开被“简单易学”掩盖的Python真相">
        <meta name="keywords" content="慕课网">
        <meta name="author" content="">
        <meta name = "format-detection" content="telephone=no">
        <meta http-equiv="Cache-Control" content="no-transform " />
        <meta http-equiv="Cache-Control" content="no-siteapp" />
        <link rel="shortcut icon" href="https://m.imooc.com/static/wap/static/favicon.ico" />
        
        
        
        <script type="text/javascript" src="https://m.imooc.com/static/wap/static/common/js/flexible.js"></script>
        
        <script type="text/javascript">
            var userInfo = "";
            
                var isApp = 0;
            
        </script>
         
<!-- 专栏首页列表模板 -->
<script type="text/template" id="index-list-tpl">
<ul class="list-con">
    {@each data.data as item}
        <li>
            <a href="/read/${item.id}" class="item clearfix">
                <div class="img l" style="background-image: url(${item.app_pic1})">
                    {@if item.is_new }
                        <div class="icon new">
                            上新
                        </div>
                    {@else if item.is_marking} 
                        <div class="icon">
                            经典
                        </div>
                    {@/if} 
                </div>
                <div class="text-con l">
                    <div class="title">
                        ${item.title}
                    </div>
                    <div class="desc">
                        ${item.chapter_num}节 · ${item.description}
                    </div>
                     <div class="user-info">
                        ${item.nickname}
                        {@if item.author_title }
                        <span class="dot">
                            ·
                        </span>
                        ${item.author_title}
                        {@/if}
                    </div>
                    <div class="info clearfix">
                    {@if !item.isBuy } 
                        <!-- 未购买才显示 -->
                        <div class="price-con l">
                        {@if item.open_discount == "1" }
                            <span class="now">￥${item.pay_price}</span>
                            <span class="ori">￥${item.price}</span>
                            <p class="sale">${item.discount_name}</p>
                        {@else}
                            <span class="now">￥${item.price}</span>
                        {@/if}
                        </div>
                    {@/if}
                        <div class="taste-con r">
                            <span>${item.numbers}人订阅</span>
                            {@if !item.isBuy }
                                <span class="gotaste">试读</span>
                            {@else}
                                <span class="gotaste">学习</span>
                            {@/if}
                        </div>
                    </div>
                </div>
            </a>
        </li>
    {@/each}
</ul>
</script>



<!-- 专栏目录 买后目录页、 -->
<script type="text/template" id="detail-catalog-tpl">
<ul class="catalog-list">
{@each data.list as item}
    <li class="zhang">
        {@if data.structure_mode == "1" }
            <!--章节模式-->
            <div class="zhang-title">
                ${item.title}（${item.count}节）
            </div>
            <div class="zhang-sub-title">
                ${item.short_introduce}
            </div>
        {@/if}  
        <ul class="zhang-detail">
            {@each item.list as it,i}
                <li class="jie">
                    {@if data.isLogin }
                        <!-- 购买了  -->
                        {@if data.isBuy }
                        <a href="javascript:;" data-link="/read/${data.column_id}/article/${it.id}" class="js-go-read">
                        {@else}
                        <a href="javascript:;" data-link="/read/${data.column_id}/article/${it.id}" class="js-go-read" >
                        {@/if}
                    {@else}
                        <!-- 未登录  -->
                        {@if data.isApp }
                            <a href="javascript:;" onclick="window.nativeSupport.login();">
                        {@else}
                            <a href="//m.imooc.com/account/login?backurl=/read/${data.column_id}">
                        {@/if}
                    {@/if}
                        <div class="jie-con {@if data.last_chapter == it.id }recent{@/if}">
                            
                            <div class="text-con">
                                <div class="jie-title">
                                    ${it.title}
                                </div>
                                <div class="jie-status">
                                    {@if it.is_open == "0" }
                                        <span class="update-time" >${it.open_time_fmt}</span>
                                    {@/if}
                                    {@if it.view_num > 100 }
                                    <div class="learn-num">
                                        <i class="imwap-set-sns"></i>
                                        <span>${it.view_num}</span>
                                    </div>
                                    {@/if}
                                    {@if it.in_24hours == "1" }
                                        <span class="update-recent">最近更新</span>
                                    {@/if}
                                </div>
                            </div>
                        </div>
                        {@if it.is_learned }
                            <div class="jie-right haslearn is_learned js-learn" data-type="1">
                                已学
                            </div>
                        {@else}
                            <!-- 购买了  -->
                            {@if data.isBuy }
                                <div class="jie-right learn js-learn" data-type="1">
                                    学习
                                </div>
                            {@else}
                                {@if it.is_pay == "0" }
                                <!--免费小节 不占用试读次数  -->
                                    <div class="jie-right learn js-learn" data-type="1">
                                        免费
                                    </div>
                                {@else}
                                    <div class="jie-right learn js-learn" data-type="0">
                                        学习
                                    </div>
                                {@/if}
                            {@/if}
                            
                            
                        {@/if}
                    </a>
                </li>
            {@/each}
        </ul>
    </li>
{@/each}
</ul>
</script> 

<!-- 阅读页 阅读页   专栏目录  -->
<script type="text/template" id="catalog-tpl">
<div>
    <h2 class="article-title">${data.a_name}</h2>
    <ul class="catalog">
    {@each data.list as item}
        <li class="zhang">
            {@if data.structure_mode == "1" }
                <!--章节模式-->
                <div class="zhang-title">
                    ${item.title}
                    <!-- <div class="num">共${item.count}节</div> -->
                </div>
            {@/if}  
            <ul class="zhang-detail">
                {@each item.list as it,i}
                    <li class="jie">
                        <!--买了且开放的-->
                        <a href="/read/${data.column_id}/article/${it.id}">
                            <div class="jie-title clearfix full">
                                <p>
                                    {@if data.last_chapter == it.id }
                                        <span class="recent">最近阅读</span>
                                    {@/if}
                                    ${it.title}
                                </p>
                            </div>
                        </a>
                    </li>
                {@/each}
            </ul>
        </li>
    {@/each}
    </ul>
</div>
</script>





<script type="text/javascript">
	var isApp = "";
	var clientVersion = "0";
	var count_num = "0";
	var chapter_id = "2264";
	var chapter_title = "17 文件对象：从文件对象的创建到文件迭代器与文件上下文管理器";
	var aid = "79";
	var a_name = "Python 核心技术精讲";
	var a_price = "78.00";
	var a_pic = "https://img1.mukewang.com/5ee98cca00018e2a05400720.jpg";
	var userId = 0;

	var column_id = '79';
	var isLogin = 0;
	

</script>
<!-- 引入字体 -->
<script type="text/javascript" src="//cdn.webfont.youziku.com/wwwroot/js/wf/youziku.api.min.js"></script>
<script type="text/javascript">
$youziku.load(".top-con .title, .cl-preview-section h1,.cl-preview-section h2,.cl-preview-section h3,.cl-preview-section h4,.cl-preview-section h5,.cl-preview-section h6", "37af461390fa4d138f5c3d277f7286dc", "SourceHanSerifSC-Heavy"); // 思源宋体heavy
$youziku.load(".lead-motto, .cl-preview-section blockquote", "d9a0d855583142c3b2cc3bf1646a8473", "SourceHanSerifSC-Regular"); // 思源宋体regular
$youziku.load("#article_content, .cl-preview-section pre, .cl-preview-section code, #code-copy", "3d84aabcf9e44b6f8c6fa91c61fa926e", "HYQiHei-55S"); // 汉仪旗黑55s
$youziku.load(".cl-preview-section strong", "fd94fff3a17546a28913a79613bddcec", "HYQiHei-77S"); // 汉仪旗黑70s

$youziku.draw();
</script>

<style type="text/css">
  header{
    display: none!important;
  }
  
  #wrapper{
  	padding-top:0px !important;
  }
  
</style>



    <link rel="stylesheet" href="https://m.imooc.com/static/wap/static/common/css/common_d42b1ef.css" /><link rel="stylesheet" href="https://m.imooc.com/static/wap/static/css/read/7.2.8/article_2d28313.css" /></head>
    <body >
        
          
        

        
          
        

        
          







<header class="directory2">
	<div class="header clearfix">
		
			
				<div class="page-title clearfix">
					<a href="//m.imooc.com" class="imwap-icon-imooc"></a>
					<div class="page-title-name js-page-name">
						<span>专栏</span>
						<i class="imwap-arrow_d"></i>
					</div>
				</div>
			

			
			<div class="drawer-box js-drawer-more">
				<i class="imwap-more_vert"></i>
				<div class="drawer-content js-drawer-content">
					<p class="line-row"></p>
					<a class="drawer-item" href="//m.imooc.com"><i class="imwap-center"></i>回到首页</a>
					<a class="drawer-item" href="//www.imooc.com/m/web/user/usercenter.html"><i class="imwap-peaple"></i>个人中心</a>
					<a class="drawer-item" href="//m.imooc.com/feedback"><i class="imwap-comment"></i>反馈问题</a>
					
					<a class="drawer-item" href="//m.imooc.com/account/login"><i class="imwap-out"></i>注册登录</a>
					
				</div>
			</div>
			

			
				<a id="js-appload" href="Javascript:;" class="app-load"><span>下载APP</span></a>
			

		
	</div>
	
	<div class="page-tab-wrap">
		<div class="page-tab-list">
			<a href="//m.imooc.com" class="page-tab-item">首页</a>
			<a href="//m.imooc.com/course/list" class="page-tab-item">课程</a>
			<a href="//coding.m.imooc.com" class="page-tab-item">实战</a>
			<a href="//class.m.imooc.com" class="page-tab-item">金职位</a>
			<a href="//m.imooc.com/article" class="page-tab-item">手记</a>
			<a href="//m.imooc.com/read" class="page-tab-item active">专栏</a>
			<a href="//m.imooc.com/wenda" class="page-tab-item">猿问</a>
			<a href="//m.imooc.com/wiki" class="page-tab-item">慕课教程</a>
			
		</div>
	</div>
	
</header>


        

        <div id="wrapper">
            <div id="middle" class="container ">

                

                
	
		
	
	<div class="top-con">
		<p class="update-time"><span>2020-08-06&nbsp;&nbsp;&nbsp;更新</span></p>
		<div class="title">
			17 文件对象：从文件对象的创建到文件迭代器与文件上下文管理器
		</div>
	</div>
	
		<div class="article-img" style="background-image: url('https://img2.mukewang.com/5f2b60ac0001eb8d06400426.jpg')"></div>
	
	
		<a href="/read/79">
			<div class="course-entry">
				<img src="https://img1.mukewang.com/5edcf963000148bc05200501-40-40.jpg" alt="郭元锴">
				<h3>Python 核心技术精讲</h3>
				<p>郭元锴 · BAT高级研发工程师</p>
				<i class="imwap-arrow_r"></i>
			</div>
		</a>
	
	
		<div class="lead-motto">
			<div class="content">宝剑锋从磨砺出，梅花香自苦寒来。<p class="author">——佚名</p></div>
		</div>
	
	
		<div class="content" id="article_content">
			
			<div class="cl-preview-section"><h2 id="引言">引言</h2>
</div><div class="cl-preview-section"><p>对于文件的处理我们一定不会陌生，比如最常使用的 <code>open()</code> 内置函数来打开一个文件，读取或者写入一些内容等等。但对于文件对象更深入一些的知识，我们可能会相对陌生一些，比如文件对象的分类、文本与二进制文件对象的区别、文件迭代器、文件上下文管理器等。在这一小节中，我们就从文件对象的定义出发，就文件对象的分类、创建、使用和常用的最佳实践等内容进行较为深入的学习。</p>
</div><div class="cl-preview-section"><h2 id="文件对象">文件对象</h2>
</div><div class="cl-preview-section"><h3 id="什么是文件对象？">什么是文件对象？</h3>
</div><div class="cl-preview-section"><p>在 Python 中，文件对象（ <code>file object</code> ）也称为文件类对象（ <code>file-like objects</code> ）或流（ <code>streams</code> ）。从表面上来看，文件对象是一种对外暴露带有 <code>read()</code> 、<code>write()</code> 等面向文件（ file-oriented ）API ，并以这些 API 来使用底层资源的对象。按照文件对象的创建方式不同，其可以链接到计算机上的真实文件、其他类型的存储、通讯设备（比如标准输入输出、网络套接字、管道）等。</p>
</div><div class="cl-preview-section"><p>再深入一些的话，文件对象可以分为原始二进制文件对象、缓冲二进制文件对象、文本文件对象。在  <a href="https://docs.python.org/zh-cn/3/library/io.html"><code>io</code> 标准库</a>中，从接口层面对它们进行了详细的定义。并且 <code>io</code> 模块提供了对各种 I/O 类型进行处理的主要工具，这些 I/O 类型包括文本 I/O、 二进制 I/O、原始 I/O 。那么从实现角度来看，文件对象（ <code>file object</code> ）则是这些通用 I/O 类型的具体对象。</p>
</div><div class="cl-preview-section"><p>关于 I/O 的定义可以参考下方维基百科中的定义。</p>
</div><div class="cl-preview-section"><blockquote>
<p>I/O（ Input/Output ），即输入／输出，通常指数据在存储器（内部和外部）或其他周边设备之间的输入和输出，是信息处理系统（例如计算机）与外部世界（可能是人类或另一信息处理系统）之间的通信。输入是系统接收的信号或数据，输出则是从其发送的信号或数据。</p>
</blockquote>
</div><div class="cl-preview-section"><h3 id="创建文件对象">创建文件对象</h3>
</div><div class="cl-preview-section"><p>使用内置函数 <code>open()</code> 来创建文件对象，这在 Python 中是一种常用的、规范的、简单的方式，它的详细形式相对��杂一些：<code>open(file, mode='r', buffering=-1, encoding=None, errors=None, newline=None, closefd=True, opener=None)</code> 。其最常用的形式为 <code>open(file, mode)</code> ，返回 <code>file</code> 对应的文件对象。<code>open()</code> 常用的参数和对应的含义在下表中列出：</p>
</div><div class="cl-preview-section"><div class="table-wrapper"><table>
<thead>
<tr>
<th>参数</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>file</code></td>
<td>通常为文件路径（可使用绝对路径或相对路径）</td>
</tr>
<tr>
<td><code>mode</code></td>
<td>指定文件打开的模式（默认为 <code>'r'</code> ，表示读取）</td>
</tr>
<tr>
<td><code>buffering</code></td>
<td>指定缓冲策略</td>
</tr>
<tr>
<td><code>encoding</code></td>
<td>指定编码名称</td>
</tr>
<tr>
<td><code>errors</code></td>
<td>指定如何处理编码和解码错误</td>
</tr>
<tr>
<td><code>newline</code></td>
<td>控制通用换行模式如何生效</td>
</tr>
</tbody>
</table>
</div></div><div class="cl-preview-section"><h4 id="file-参数"><code>file</code> 参数</h4>
</div><div class="cl-preview-section"><p>我们需要对上述表格中常用的参数进行更加详细的说明。首先，<code>file</code> 参数通常为文件路径，这个文件路径可以为绝对路径，也可以为相对路径。路径可以包含一个目录路径前缀和文件名，当无目录路径时默认该被打开的文件位于当前工作目录。</p>
</div><div class="cl-preview-section"><p>更准确的说，<code>file</code> 可为一个路径类对象（ <code>path-like object</code> ），一个 <code>path-like object</code> 可为一个代表路径的 <code>str</code> 或 <code>bytes</code> ，也可为一个实现了 <code>os.PathLike</code> 接口的对象，具体细节可以参考 <a href="https://www.python.org/dev/peps/pep-0519/">PEP 519</a> 。在后面我们学习了 <code>duck-typing</code> 和抽象基类的概念后，会对 Python 中 “接口” 的含义有更加深入的理解。</p>
</div><div class="cl-preview-section"><h4 id="mode-参数"><code>mode</code> 参数</h4>
</div><div class="cl-preview-section"><p><code>mode</code> 参数用于指定文件打开的模式，基础模式包括以下四种：</p>
</div><div class="cl-preview-section"><ul>
<li><code>'r'</code> 为默认值，表示以读取（输入）模式打开文件，若文件不存在，则会引发 <code>FileNotFoundError</code> ；</li>
<li><code>'w'</code> 表示以写入（输出）模式打开文件，若文件不存在时会生成文件，若文件已存在时，则会清空文件之前的内容（ truncating the file ）；</li>
<li><code>'a'</code> 表示以追加写入模式打开文件，若文件不存在时会生成文件，若文件已存在时会在文件尾部内容后继续追加写入；</li>
<li><code>'x'</code> 表示排它性的生成文件，当文件不存在时生成文件，当文件存在时会引发 <code>FileExistsError</code>。</li>
</ul>
</div><div class="cl-preview-section"><p>以上几种模式中，<code>'r'</code> 只支持读取（只读），其余三种 <code>'w'</code>、<code>'a'</code>、<code>'x'</code> 只支持写入（只写），如果在只读模式（或只写模式）下调用 <code>write</code> （ <code>read</code> ）相关方法则会引发  <code>io.UnsupportedOperation</code> 。</p>
</div><div class="cl-preview-section"><pre class=" language-python"><code class="prism  language-python"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'test.txt'</span><span class="token punctuation">)</span>
FileNotFoundError<span class="token punctuation">:</span> <span class="token punctuation">[</span>Errno <span class="token number">2</span><span class="token punctuation">]</span> No such <span class="token builtin">file</span> <span class="token operator">or</span> directory<span class="token punctuation">:</span> <span class="token string">'test.txt'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'test.txt'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> f<span class="token punctuation">.</span>readable<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> f<span class="token punctuation">.</span>writable<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
io<span class="token punctuation">.</span>UnsupportedOperation<span class="token punctuation">:</span> <span class="token operator">not</span> readable
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'test.txt'</span><span class="token punctuation">,</span> <span class="token string">'x'</span><span class="token punctuation">)</span>
FileExistsError<span class="token punctuation">:</span> <span class="token punctuation">[</span>Errno <span class="token number">17</span><span class="token punctuation">]</span> File exists<span class="token punctuation">:</span> <span class="token string">'test.txt'</span>
</code></pre>
</div><div class="cl-preview-section"><p>另外，在基础模式之上，还可以加入 <code>b</code> / <code>t</code>、<code>+</code> 字符，它们分别表示：</p>
</div><div class="cl-preview-section"><ul>
<li>在模式参数中加上 <code>'b'</code>（默认为 <code>'t'</code>，表示文本模式，即 <code>'r'</code> 与 <code>'rt'</code> 表示同样的含义），表示二进制模式，用于处理二进制数据；</li>
<li>在模式参数中加上 <code>'+'</code>，表示同时支持读取和写入（读写）。<code>'r+'</code> 在支持读写时，若文件存在时不会清空文件之前的内容（但在正常写入时会对原有内容进行覆盖），若文件不存在时，会引发异常； <code>'w+'</code> 在支持读写时， 若文件存在时会清空文件之前的内容，若文件不存在时会生成文件；<code>'a+'</code> 在支持读写时，若文件存在时会在原有内容后追加写入，若文件不存在时会生成文件。</li>
</ul>
</div><div class="cl-preview-section"><p>在下面的示例代码执行前删除掉目录下原先存在的 <code>test.txt</code> 文件，从最后的文件内容可以看到 <code>'345'</code> 覆盖了原先写入的 <code>'012'</code> 。</p>
</div><div class="cl-preview-section"><pre class=" language-python"><code class="prism  language-python"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'test.txt'</span><span class="token punctuation">,</span> <span class="token string">'r+'</span><span class="token punctuation">)</span>
FileNotFoundError<span class="token punctuation">:</span> <span class="token punctuation">[</span>Errno <span class="token number">2</span><span class="token punctuation">]</span> No such <span class="token builtin">file</span> <span class="token operator">or</span> directory<span class="token punctuation">:</span> <span class="token string">'test.txt'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'test.txt'</span><span class="token punctuation">,</span> <span class="token string">'w+'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'012'</span><span class="token punctuation">)</span>
<span class="token number">3</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'test.txt'</span><span class="token punctuation">,</span> <span class="token string">'r+'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'345'</span><span class="token punctuation">)</span>
<span class="token number">3</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'test.txt'</span><span class="token punctuation">,</span> <span class="token string">'a+'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'678'</span><span class="token punctuation">)</span>
<span class="token number">3</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'test.txt'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token string">'345678'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
</div><div class="cl-preview-section"><p>关于 <code>encoding</code> 参数和 <code>newline</code> 参数我们在下面文本与二进制文件中会提到，其他不常用的参数含义和使用方法可以参考 <a href="https://docs.python.org/zh-cn/3/library/functions.html#open">官方文档</a> 。</p>
</div><div class="cl-preview-section"><p>还需要注意的一点是，对于 Python 2.X 和 Python 3.X 来说，对于文件对象产生了一些变化。2.X 中 <code>file</code> 和 <code>open</code> 共存，不仅可以使用 <code>open</code>，还可以使用 <code>file</code> 来创建文件对象，而在 3.X 中 <code>file</code> 已经不再被支持。</p>
</div><div class="cl-preview-section"><h3 id="文本与二进制文件">文本与二进制文件</h3>
</div><div class="cl-preview-section"><p>文本文件（ text file ）是一种可以对 <code>str</code> 进行读写处理的文件对象，二进制文件（ binary file ）是一种可以对字节类对象（ bytes-like object ）进行读写处理的文件对象。我们在上面创建文件对象中，已经提到了创建文本文件和二进制文件最常用的方式是使用 <code>open()</code> 的文本模式和二进制模式。</p>
</div><div class="cl-preview-section"><h4 id="encoding-参数"><code>encoding</code> 参数</h4>
</div><div class="cl-preview-section"><p>对于文本文件来说，<code>open()</code> 函数的 <code>encoding</code> 参数可用于指定编解码文件的编码名称，在不指定 <code>encoding</code> 时， 其为当前平台的默认编码，可通过 <code>locale.getpreferredencoding(False)</code> 来获取当前平台的编码值。</p>
</div><div class="cl-preview-section"><pre class=" language-python"><code class="prism  language-python"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">import</span> locale
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> locale<span class="token punctuation">.</span>getpreferredencoding<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>
<span class="token string">'UTF-8'</span>
</code></pre>
</div><div class="cl-preview-section"><p>需要注意的是，<code>encoding</code> 只应在以文本模式打开文件时使用，以二进制模式打开文件时不应指定 <code>encoding</code> 。</p>
</div><div class="cl-preview-section"><pre class=" language-python"><code class="prism  language-python"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'UTF-8'</span><span class="token punctuation">)</span>
ValueError<span class="token punctuation">:</span> binary mode doesn't take an encoding argument
</code></pre>
</div><div class="cl-preview-section"><h4 id="newline-参数"><code>newline</code> 参数</h4>
</div><div class="cl-preview-section"><p>同时，<code>newline</code> 也是另外一个仅适用于 <code>open()</code> 文本模式下的参数，它可用于控制通用换行的作用方式。通用换行（ universal newlines ）是解读文本中行结束符的方式，它将 Unix 平台下的行结束符 <code>'\n'</code> ，Windows 平台下的行结束符 <code>'\r\n'</code> 等均作为文本行结束的标志。</p>
</div><div class="cl-preview-section"><p><code>newline</code> 可为 <code>None</code>、<code>''</code>、<code>'\n'</code>、<code>'\r'</code>、<code>'\r\n'</code>，默认值为 <code>None</code> ，表示使用 <code>open()</code> 读取时默认会把不同平台下特定的行结束符转换为 <code>'\n'</code> ，在写入时，默认把 <code>'\n'</code> 转换为不同平台下特定的行结束符。</p>
</div><div class="cl-preview-section"><h4 id="文件对象总结">文件对象总结</h4>
</div><div class="cl-preview-section"><p>在了解了文本模式下的编解码和换行等概念后，我们对 <code>open()</code> 创建的常用文本文件和二进制文件进行一个简单的总结：</p>
</div><div class="cl-preview-section"><ul>
<li>文本文件的内容表示为 <code>str</code> ，会默认进行 Unicode 编解码以及行末结束符转换（所以不能以文本模式处理一个二进制文件）；</li>
<li>二进制文件的内容通常表示为 <code>bytes</code> ，打开文件时需要在 <code>open()</code> 的模式字符串参数 <code>mode</code> 中添加 <code>'b'</code> ，不会进行解码等处理。</li>
</ul>
</div><div class="cl-preview-section"><p>上面的内容都是基于 Python 3.X 的，可以看出在 Python 3.X 中，对文本文件和二进制文件的区分是非常明确的。Python 3.X 与 2.X 在文本文件和二进制文件上的处理具有一些不同点，在这里我们需要对 Python 2.X 中与此相关的内容进行简单的了解。在 2.X 中，文本文件不仅可以处理 8 位文本，还可以处理二进制数据，而对于 Unicode 文本文件则通过标准库中 <code>codecs.open()</code> 来打开并处理。</p>
</div><div class="cl-preview-section"><p>造成这种处理区别的主要原因是：3.X 中将 2.X 中 “割裂” 的文本字符串进行了统一，将可用 8 位字节表示的文本字符串和 Unicode 文本字符串进行了合并，使用统一的 <code>str</code> 来表示文本字符串。</p>
</div><div class="cl-preview-section"><h3 id="文件对象常用方法">文件对象常用方法</h3>
</div><div class="cl-preview-section"><p>创建了一个文件对象后，我们可以使用文件对象支持的相关方法对其进行处理。首先创建一个文本文件，并写入一些测试内容。</p>
</div><div class="cl-preview-section"><pre class=" language-python"><code class="prism  language-python"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'test.txt'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'hello world!\nhello world!\nhello world!'</span><span class="token punctuation">)</span>
<span class="token number">38</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
</div><div class="cl-preview-section"><h4 id="读取内容">读取内容</h4>
</div><div class="cl-preview-section"><p><code>f.read(size)</code> 可以读取文件中的数据并将其作为字符串（或字节串）返回，若省略 <code>size</code> 或者 <code>size</code> 为负数，则将读取整个文件内容；若 <code>size</code> 为正数，则读取 <code>size</code> 个字符（或字节）。</p>
</div><div class="cl-preview-section"><p><code>f.readline()</code> 可以读取文件中一行（读取的内容中包含 <code>'\n'</code> 换行符），<code>f.readlines()</code> 可以按行读取整个文本（读取的内容中包含 <code>'\n'</code> 换行符）至一个列表中。</p>
</div><div class="cl-preview-section"><pre class=" language-python"><code class="prism  language-python"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'test.txt'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token string">'hel'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> f<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token string">'lo world!\n'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token string">'hello world!\n'</span><span class="token punctuation">,</span> <span class="token string">'hello world!'</span><span class="token punctuation">]</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token string">''</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
</div><div class="cl-preview-section"><h4 id="写入内容">写入内容</h4>
</div><div class="cl-preview-section"><p>与读取相对应的，文件写入相关的方法包括 <code>f.write()</code> 、<code>f.writelines(lines)</code> 。前者不再赘述，后者 <code>f.writelines(lines)</code> 可将列表 <code>lines</code> 中的内容写入文件中。</p>
</div><div class="cl-preview-section"><pre class=" language-python"><code class="prism  language-python"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'test.txt'</span><span class="token punctuation">,</span> <span class="token string">'a+'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> f<span class="token punctuation">.</span>writelines<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'hello world!'</span><span class="token punctuation">,</span> <span class="token string">'hello world!\n'</span><span class="token punctuation">,</span> <span class="token string">'hello world!'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
</div><div class="cl-preview-section"><p>通过上面的 <code>f.writelines(...)</code> 写入相关内容后 <code>test.txt</code> 中的内容如下。</p>
</div><div class="cl-preview-section"><pre class=" language-bash"><code class="prism  language-bash">hello world<span class="token operator">!</span> 
hello world<span class="token operator">!</span>
hello world<span class="token operator">!</span>
hello world<span class="token operator">!</span>hello world<span class="token operator">!</span>
hello world<span class="token operator">!</span>
</code></pre>
</div><div class="cl-preview-section"><h4 id="文件位置">文件位置</h4>
</div><div class="cl-preview-section"><p>两个和文件位置相关的方法分别为 <code>f.tell()</code> 和 <code>f.seek(offset, whence)</code>，<code>f.tell()</code> 可以获取文件对象的当前位置， <code>f.seek(offset, whence)</code> 可以改变文件对象的位置。这两种方法表明文件对象可被定位，我们可以在文件的任意位置进行读写。前者的使用较为简单不再赘述，它的结果在二进制模式下为从文件起始位置开始计算的字节数。</p>
</div><div class="cl-preview-section"><p>这里我们着重了解一下后者的使用方法。<code>f.seek(offset, whence)</code> 通过向参考位置 <code>whence</code> 添加 <code>offset</code> 数量的偏移量来改变文件对象的位置，当 <code>whence</code> 为 <code>0</code> 时（默认为 <code>0</code>），表示参考位置为文件起始；当<code>whence</code> 为 <code>1</code> 时，表示参考位置为当前位置；当 <code>whence</code> 为 <code>2</code> 时，表示参考位置为文件末尾。</p>
</div><div class="cl-preview-section"><pre class=" language-python"><code class="prism  language-python"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'test.bin'</span><span class="token punctuation">,</span> <span class="token string">'wb+'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>b<span class="token string">'0123456789'</span><span class="token punctuation">)</span>
<span class="token number">10</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> f<span class="token punctuation">.</span>seek<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token number">2</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
b<span class="token string">'2'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> f<span class="token punctuation">.</span>tell<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token number">3</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> f<span class="token punctuation">.</span>seek<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token number">9</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
b<span class="token string">'9'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
</div><div class="cl-preview-section"><p>需要注意的是，区别于上面二进制文件的示例，在文本文件上使用 <code>seek()</code> 方法时，除了 <code>f.seek(0, 2)</code> 和 <code>f.seek(0, 1)</code> 外，其余的情况下参考位置只能为文件起始 。</p>
</div><div class="cl-preview-section"><pre class=" language-python"><code class="prism  language-python"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'test.txt'</span><span class="token punctuation">,</span> <span class="token string">'w+'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'0123456789'</span><span class="token punctuation">)</span>
<span class="token number">10</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> f<span class="token punctuation">.</span>seek<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
io<span class="token punctuation">.</span>UnsupportedOperation<span class="token punctuation">:</span> can't do nonzero cur<span class="token operator">-</span>relative seeks
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> f<span class="token punctuation">.</span>seek<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
io<span class="token punctuation">.</span>UnsupportedOperation<span class="token punctuation">:</span> can't do nonzero end<span class="token operator">-</span>relative seeks
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> f<span class="token punctuation">.</span>seek<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token number">10</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> f<span class="token punctuation">.</span>seek<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token number">10</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> f<span class="token punctuation">.</span>seek<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token number">3</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
</div><div class="cl-preview-section"><h4 id="文件的关闭">文件的关闭</h4>
</div><div class="cl-preview-section"><p>当我们使用文件对象进行文本或字节串写入时，通常默认情况下，被写入的内容不会立即从内存中输出到硬盘，这些数据会被缓冲，当文件被关闭或者手动调用 <code>f.flush()</code> 方法时，才能将内存中的缓冲数据输出到硬盘中。</p>
</div><div class="cl-preview-section"><p>在处理文件对象的最后，应及时调用 <code>f.close()</code> 来关闭文件以结束其和外部资源的连接，释放其占用的系统资源。当然，这也会将我们上面提到的缓冲内容写入到硬盘中。如果没有关闭文件， Python 的垃圾回收（当对象不再被引用，引用计数机制会自动将该对象的内存进行回收）会在一段时间后销毁该文件对象并关闭该文件。</p>
</div><div class="cl-preview-section"><p>虽然文件对象在回收后会被自动关闭，但最好不应依赖这种特性。首先，这会导致文件对象在停止使用之后仍在一段时间内保持打开状态；其次，对于不同的 Python 实现，这种机制也可能会不同。在下面我们会了解到文件上下文管理器的使用，这是一种确保文件对象被关闭的方法，可以更加简洁的处理文件对象。</p>
</div><div class="cl-preview-section"><h2 id="文件使用相关的最佳实践">文件使用相关的最佳实践</h2>
</div><div class="cl-preview-section"><h3 id="逐行读取文件">逐行读取文件</h3>
</div><div class="cl-preview-section"><p>在上面我们提到了可以逐行读取文件的相关方法，包括 <code>f.readline()</code> 、<code>f.readlines()</code> 等。比如在调用 <code>f.readline()</code> 时，每次都会返回文件的下一行，结合循环我们可以逐行的读取文件，循环的结束条件便是当文件到达末尾后<code>f.readline()</code> 会返回空字符串。</p>
</div><div class="cl-preview-section"><pre class=" language-python"><code class="prism  language-python"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'test.txt'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     line <span class="token operator">=</span> f<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">if</span> <span class="token operator">not</span> line<span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>         <span class="token keyword">break</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">print</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>  
</code></pre>
</div><div class="cl-preview-section"><p>当然，也会有像下面这样的处理方式：</p>
</div><div class="cl-preview-section"><pre class=" language-python"><code class="prism  language-python"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'test.txt'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">for</span> line <span class="token keyword">in</span> f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">print</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>  
</code></pre>
</div><div class="cl-preview-section"><p>相比于使用 <code>f.readline()</code> ，上面这种方法看起来更加简洁一些，但这种方法有一个潜在的问题便是在调用 <code>f.readlines()</code> 时会将文件中的数据一次全部加载到内容中，如果文件过大，则有可能会造成计算机内存不足问题。同样的，对于 <code>f.read(size)</code> ，若省略 <code>size</code> 或 <code>size</code> 指定负数时，也会读取整个文件，在文件过大时也会存在内存问题。</p>
</div><div class="cl-preview-section"><p>那么目前来说，逐行读取文件最好的方法是什么呢？答案是使用文件迭代器，我们先来看看具体的用法示例。</p>
</div><div class="cl-preview-section"><pre class=" language-python"><code class="prism  language-python"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">for</span> line <span class="token keyword">in</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'test.txt'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>  
</code></pre>
</div><div class="cl-preview-section"><p>可以看到上面的示例十分简单，并没有特殊的处理，但可以简单、快速且内存高效的实现逐行读取文件。简要的说，这是因为文件对象本身就是一个迭代器，在 <code>for</code> 循环或其他迭代环境下，在每次迭代中会自动调用文件对象的 <code>__next__</code> 方法，它的效果和 <code>f.readline()</code> 基本相同，会返回文件的下一行，不同点在于 <code>__next__</code> 方法在文件末尾时不会像 <code>f.readline()</code> 那样返回空字符串，而是会引发 <code>StopIteration</code> ，这个异常则会在 <code>for</code> 循环或其他迭代环境中被捕获，以用于终止迭代。</p>
</div><div class="cl-preview-section"><p>与 <code>f.readline()</code>  结合 <code>while</code> 循环的逐行读取效果相似，文件迭代器在每次迭代中会自动的读取下一行。通过文件迭代器逐行读取不仅在实现上简化了代码，并且通常情况下基于迭代器的 <code>for</code> 循环在 Python 内部的运行速度快于 <code>while</code> 循环。而相比于 <code>f.readlines()</code> ，文件迭代器在内存利用上是高效的，它每次迭代只读取一行内容，不会因为文件的大小而产生内存问题。</p>
</div><div class="cl-preview-section"><h3 id="文件上下文管理器">文件上下文管理器</h3>
</div><div class="cl-preview-section"><p>在上面文件关闭的内容中，我们提到了文件上下文管理器，它可以更加简洁的处理文件的关闭。我们先来看看文件上下文管理器的一个简单示例：</p>
</div><div class="cl-preview-section"><pre class=" language-python"><code class="prism  language-python"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'test.txt'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">for</span> line <span class="token keyword">in</span> f<span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>         <span class="token keyword">print</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> 
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> f<span class="token punctuation">.</span>closed
<span class="token boolean">True</span>
</code></pre>
</div><div class="cl-preview-section"><p>这样处理的优点便是当代码块执行完后会自动地保证文件正确关闭，避免了手动显式调用 <code>f.close()</code> 或等待垃圾回收来自动关闭文件。更重要的一点是，即使上面的代码块在执行中出现了异常，文件也是能够被正确关闭的，相比于下面 <code>try-finally</code> 的处理，文件上下文管理器更加简洁一些。</p>
</div><div class="cl-preview-section"><pre class=" language-python"><code class="prism  language-python"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">try</span><span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">for</span> line <span class="token keyword">in</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'test.txt'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>         <span class="token keyword">print</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">finally</span><span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>  
</code></pre>
</div><div class="cl-preview-section"><p>更多的关于 <code>with</code> 语句以及上下文管理器的相关内部原理我们在后面的小节进行讲解。</p>
</div><div class="cl-preview-section"><h2 id="总结">总结</h2>
</div><div class="cl-preview-section"><p>在本小节中，我们以 <code>open()</code> 函数和它所创建的文件对象为基础，对文件对象常用的创建、使用、关闭，文本文件和二进制文件，以及包括文件迭代器、文件上下文管理器等文件使用相关的最佳实践进行了一定程度的学习。当然，在 Python 中除了 <code>open()</code> 这个主要的文件工具外，还有包括套接字、管道、标准流等文件工具，相信在未来大家会接触到更多的文件对象，从而对其有新的认知。</p>
</div>
			
		</div>
	
	
	<div class="finish-learn">
		<p class="copyright">©版权归慕课网所有，未经许可不得转载</p>
		
		
		
		<div class="ad_pic">
			<img src="https://img4.mukewang.com/5f2b60b200011d7f06700192.jpg">
		</div>
		
		
		
		
	</div>
	<div class="comment-con">
		<h4 class="title">
			精选留言
			
				<a href="javascript: void(0);" class="add-comment js-comment-click"><i class="imwap-xieliuyan"></i><span>写留言</span></a>
			
		</h4>
		
			<p class="bottom-text empty">暂无精选留言</p>
		
	</div>
	
	

	
		
	
	
	
		<div class="bottom-con">
			
			
				<div class="inner">
					
						<div class="price-con js-price-con">
							<span class="now">￥78.00</span>
						</div>
							
					
					
					<a class="gobuy js-gobuy" href="//m.imooc.com/account/login?backurl=//m.imooc.com/confirmorder?type=30&typeid=79">
					
						立即购买
					</a>  
				</div>
			
		</div>
	
	<div class="layer-catalog js-layer-catalog hide">
		<div class="layer-title clearfix">
			<div class="l">
				课程目录
			</div>
			
		</div>
		<div class="layer-wrap">
			<div class="js-catalog-container">
			</div>
		</div>
	</div>
	<div class="layer-comment">
		<div class="inner">
			<h5>
				<span class="btn l js-cancel-comment">取消</span>
				评论
				<span class="btn r js-send-comment">发送</span>
			</h5>
			<textarea id="comment-txt" maxlength="20000" placeholder="欢迎在这里发表留言，作者筛选后可公开显示"></textarea>
		</div>
	</div>


            </div>
        </div>
        
            
         
        
        
        
        




<script>
	// 设置字号大小及选中
	(function() {
			var fs = window.localStorage.getItem('font-size') || 'normal';
			var $c = document.querySelector('#middle>.content');
			var $points = document.querySelectorAll('.setting-box .point');
			try{
				// 抢读完了时 该元素不渲染 会有报错
				$c.className = 'content ' + fs;
				for(var i = 0; i < $points.length; i++) {
					if($points[i].className.indexOf(fs) > -1) {
						$points[i].className = $points[i].className + ' current';
					}
				}
			} catch(e) {}
			
	})();
</script>

<script type="text/javascript">
	window.onload = function() {
			zhuge.track('LearnCourse', {
					'Category': '专栏',
					'Name': '17 文件对象：从文件对象的创建到文件迭代器与文件上下文管理器',
					'CID': '2264',
					'Teacher': '郭元锴'
			});
	}
</script>

        
            <script type="text/javascript">
                var shareData = { 
                    title:  "17 文件对象：从文件对象的创建到文件迭代器与文件上下文管理器",
                    desc: "揭开被“简单易学”掩盖的Python真相",
                    imgUrl: 'https:https://img1.mukewang.com/5ee98cca00018e2a05400720.jpg',
                    otherImgUrl: 'https://img1.mukewang.com/5ee98cca00018e2a05400720.jpg',
                    text: '我正在参加@慕课网的课程，很不错哦！快来一起学习吧！',
                    // url: 'https://www.imooc.com' + window.location.pathname + window.location.search
                    url: 'https://m.imooc.com/read/79',
                    link: 'https://m.imooc.com/read/79'
                }
            </script>
            
        
        <div style="display:none;">
            <!-- 百度统计 -->
            <script>
            var _hmt = _hmt || [];
            (function() {
              var hm = document.createElement("script");
              hm.src = "https://hm.baidu.com/hm.js?c92536284537e1806a07ef3e6873f2b3";
              var s = document.getElementsByTagName("script")[0];
              s.parentNode.insertBefore(hm, s);
            })();
            </script>

            <script>
            (function(){
                var bp = document.createElement('script');
                var curProtocol = window.location.protocol.split(':')[0];
                if (curProtocol === 'https') {
                    bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
                }
                else {
                    bp.src = 'http://push.zhanzhang.baidu.com/push.js';
                }
                var s = document.getElementsByTagName("script")[0];
                s.parentNode.insertBefore(bp, s);
            })();
            </script>
        </div>
        
    <script type="text/javascript" src="https://m.imooc.com/static/wap/static/lib/zhugeio/init_f9752c3.js"></script><script type="text/javascript" src="https://m.imooc.com/static/wap/static/common/js/jquery-2.1.0.min_ac9f840.js"></script><script type="text/javascript" src="https://m.imooc.com/static/wap/static/common/js/common_84429c0.js"></script><script type="text/javascript" src="https://m.imooc.com/static/wap/static/lib/juicer/juicer.min_8643248.js"></script><script type="text/javascript" src="https://m.imooc.com/static/wap/static/lib/previewImage/previewImage.min_43b970d.js"></script><script type="text/javascript" src="https://m.imooc.com/static/wap/static/common/js/msg_bed8d10.js"></script><script type="text/javascript" src="https://m.imooc.com/static/wap/static/js/read/7.2.8/article_30e5762.js"></script><script type="text/javascript" src="https://m.imooc.com/static/wap/static/js/course/advertisementReport_6e58a98.js"></script></body>
</html>
