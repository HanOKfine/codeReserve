<!doctype html>
<html lang="zh_CN">

    

    

    
    
    
    <head>
        
        <title>17 网卡监控：如何获取网卡的状态信息呢？</title>
        
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="description" content="学好通用知识，提升技术竞争力">
        <meta name="keywords" content="慕课网">
        <meta name="author" content="">
        <meta name = "format-detection" content="telephone=no">
        <meta http-equiv="Cache-Control" content="no-transform " />
        <meta http-equiv="Cache-Control" content="no-siteapp" />
        <link rel="shortcut icon" href="https://m.imooc.com/static/wap/static/favicon.ico" />
        
        
        
        <script type="text/javascript" src="https://m.imooc.com/static/wap/static/common/js/flexible.js"></script>
        
        <script type="text/javascript">
            var userInfo = "";
            
                var isApp = 0;
            
        </script>
         
<!-- 专栏首页列表模板 -->
<script type="text/template" id="index-list-tpl">
<ul class="list-con">
    {@each data.data as item}
        <li>
            <a href="/read/${item.id}" class="item clearfix">
                <div class="img l" style="background-image: url(${item.app_pic1})">
                    {@if item.is_new }
                        <div class="icon new">
                            上新
                        </div>
                    {@else if item.is_marking} 
                        <div class="icon">
                            经典
                        </div>
                    {@/if} 
                </div>
                <div class="text-con l">
                    <div class="title">
                        ${item.title}
                    </div>
                    <div class="desc">
                        ${item.chapter_num}节 · ${item.description}
                    </div>
                     <div class="user-info">
                        ${item.nickname}
                        {@if item.author_title }
                        <span class="dot">
                            ·
                        </span>
                        ${item.author_title}
                        {@/if}
                    </div>
                    <div class="info clearfix">
                    {@if !item.isBuy } 
                        <!-- 未购买才显示 -->
                        <div class="price-con l">
                        {@if item.open_discount == "1" }
                            <span class="now">￥${item.pay_price}</span>
                            <span class="ori">￥${item.price}</span>
                            <p class="sale">${item.discount_name}</p>
                        {@else}
                            <span class="now">￥${item.price}</span>
                        {@/if}
                        </div>
                    {@/if}
                        <div class="taste-con r">
                            <span>${item.numbers}人订阅</span>
                            {@if !item.isBuy }
                                <span class="gotaste">试读</span>
                            {@else}
                                <span class="gotaste">学习</span>
                            {@/if}
                        </div>
                    </div>
                </div>
            </a>
        </li>
    {@/each}
</ul>
</script>



<!-- 专栏目录 买后目录页、 -->
<script type="text/template" id="detail-catalog-tpl">
<ul class="catalog-list">
{@each data.list as item}
    <li class="zhang">
        {@if data.structure_mode == "1" }
            <!--章节模式-->
            <div class="zhang-title">
                ${item.title}（${item.count}节）
            </div>
            <div class="zhang-sub-title">
                ${item.short_introduce}
            </div>
        {@/if}  
        <ul class="zhang-detail">
            {@each item.list as it,i}
                <li class="jie">
                    {@if data.isLogin }
                        <!-- 购买了  -->
                        {@if data.isBuy }
                        <a href="javascript:;" data-link="/read/${data.column_id}/article/${it.id}" class="js-go-read">
                        {@else}
                        <a href="javascript:;" data-link="/read/${data.column_id}/article/${it.id}" class="js-go-read" >
                        {@/if}
                    {@else}
                        <!-- 未登录  -->
                        {@if data.isApp }
                            <a href="javascript:;" onclick="window.nativeSupport.login();">
                        {@else}
                            <a href="//m.imooc.com/account/login?backurl=/read/${data.column_id}">
                        {@/if}
                    {@/if}
                        <div class="jie-con {@if data.last_chapter == it.id }recent{@/if}">
                            
                            <div class="text-con">
                                <div class="jie-title">
                                    ${it.title}
                                </div>
                                <div class="jie-status">
                                    {@if it.is_open == "0" }
                                        <span class="update-time" >${it.open_time_fmt}</span>
                                    {@/if}
                                    {@if it.view_num > 100 }
                                    <div class="learn-num">
                                        <i class="imwap-set-sns"></i>
                                        <span>${it.view_num}</span>
                                    </div>
                                    {@/if}
                                    {@if it.in_24hours == "1" }
                                        <span class="update-recent">最近更新</span>
                                    {@/if}
                                </div>
                            </div>
                        </div>
                        {@if it.is_learned }
                            <div class="jie-right haslearn is_learned js-learn" data-type="1">
                                已学
                            </div>
                        {@else}
                            <!-- 购买了  -->
                            {@if data.isBuy }
                                <div class="jie-right learn js-learn" data-type="1">
                                    学习
                                </div>
                            {@else}
                                {@if it.is_pay == "0" }
                                <!--免费小节 不占用试读次数  -->
                                    <div class="jie-right learn js-learn" data-type="1">
                                        免费
                                    </div>
                                {@else}
                                    <div class="jie-right learn js-learn" data-type="0">
                                        学习
                                    </div>
                                {@/if}
                            {@/if}
                            
                            
                        {@/if}
                    </a>
                </li>
            {@/each}
        </ul>
    </li>
{@/each}
</ul>
</script> 

<!-- 阅读页 阅读页   专栏目录  -->
<script type="text/template" id="catalog-tpl">
<div>
    <h2 class="article-title">${data.a_name}</h2>
    <ul class="catalog">
    {@each data.list as item}
        <li class="zhang">
            {@if data.structure_mode == "1" }
                <!--章节模式-->
                <div class="zhang-title">
                    ${item.title}
                    <!-- <div class="num">共${item.count}节</div> -->
                </div>
            {@/if}  
            <ul class="zhang-detail">
                {@each item.list as it,i}
                    <li class="jie">
                        <!--买了且开放的-->
                        <a href="/read/${data.column_id}/article/${it.id}">
                            <div class="jie-title clearfix full">
                                <p>
                                    {@if data.last_chapter == it.id }
                                        <span class="recent">最近阅读</span>
                                    {@/if}
                                    ${it.title}
                                </p>
                            </div>
                        </a>
                    </li>
                {@/each}
            </ul>
        </li>
    {@/each}
    </ul>
</div>
</script>





<script type="text/javascript">
	var isApp = "";
	var clientVersion = "0";
	var count_num = "0";
	var chapter_id = "2106";
	var chapter_title = "17 网卡监控：如何获取网卡的状态信息呢？";
	var aid = "80";
	var a_name = "零基础学透网络编程";
	var a_price = "58.00";
	var a_pic = "https://img3.mukewang.com/5ed8c1c600015fc805400720.jpg";
	var userId = 0;

	var column_id = '80';
	var isLogin = 0;
	

</script>
<!-- 引入字体 -->
<script type="text/javascript" src="//cdn.webfont.youziku.com/wwwroot/js/wf/youziku.api.min.js"></script>
<script type="text/javascript">
$youziku.load(".top-con .title, .cl-preview-section h1,.cl-preview-section h2,.cl-preview-section h3,.cl-preview-section h4,.cl-preview-section h5,.cl-preview-section h6", "37af461390fa4d138f5c3d277f7286dc", "SourceHanSerifSC-Heavy"); // 思源宋体heavy
$youziku.load(".lead-motto, .cl-preview-section blockquote", "d9a0d855583142c3b2cc3bf1646a8473", "SourceHanSerifSC-Regular"); // 思源宋体regular
$youziku.load("#article_content, .cl-preview-section pre, .cl-preview-section code, #code-copy", "3d84aabcf9e44b6f8c6fa91c61fa926e", "HYQiHei-55S"); // 汉仪旗黑55s
$youziku.load(".cl-preview-section strong", "fd94fff3a17546a28913a79613bddcec", "HYQiHei-77S"); // 汉仪旗黑70s

$youziku.draw();
</script>

<style type="text/css">
  header{
    display: none!important;
  }
  
  #wrapper{
  	padding-top:0px !important;
  }
  
</style>



    <link rel="stylesheet" href="https://m.imooc.com/static/wap/static/common/css/common_d42b1ef.css" /><link rel="stylesheet" href="https://m.imooc.com/static/wap/static/css/read/7.2.8/article_2d28313.css" /></head>
    <body >
        
          
        

        
          
        

        
          







<header class="directory2">
	<div class="header clearfix">
		
			
				<div class="page-title clearfix">
					<a href="//m.imooc.com" class="imwap-icon-imooc"></a>
					<div class="page-title-name js-page-name">
						<span>专栏</span>
						<i class="imwap-arrow_d"></i>
					</div>
				</div>
			

			
			<div class="drawer-box js-drawer-more">
				<i class="imwap-more_vert"></i>
				<div class="drawer-content js-drawer-content">
					<p class="line-row"></p>
					<a class="drawer-item" href="//m.imooc.com"><i class="imwap-center"></i>回到首页</a>
					<a class="drawer-item" href="//www.imooc.com/m/web/user/usercenter.html"><i class="imwap-peaple"></i>个人中心</a>
					<a class="drawer-item" href="//m.imooc.com/feedback"><i class="imwap-comment"></i>反馈问题</a>
					
					<a class="drawer-item" href="//m.imooc.com/account/login"><i class="imwap-out"></i>注册登录</a>
					
				</div>
			</div>
			

			
				<a id="js-appload" href="Javascript:;" class="app-load"><span>下载APP</span></a>
			

		
	</div>
	
	<div class="page-tab-wrap">
		<div class="page-tab-list">
			<a href="//m.imooc.com" class="page-tab-item">首页</a>
			<a href="//m.imooc.com/course/list" class="page-tab-item">课程</a>
			<a href="//coding.m.imooc.com" class="page-tab-item">实战</a>
			<a href="//class.m.imooc.com" class="page-tab-item">金职位</a>
			<a href="//m.imooc.com/article" class="page-tab-item">手记</a>
			<a href="//m.imooc.com/read" class="page-tab-item active">专栏</a>
			<a href="//m.imooc.com/wenda" class="page-tab-item">猿问</a>
			<a href="//m.imooc.com/wiki" class="page-tab-item">慕课教程</a>
			
		</div>
	</div>
	
</header>


        

        <div id="wrapper">
            <div id="middle" class="container ">

                

                
	
		
	
	<div class="top-con">
		<p class="update-time"><span>2020-06-09&nbsp;&nbsp;&nbsp;更新</span></p>
		<div class="title">
			17 网卡监控：如何获取网卡的状态信息呢？
		</div>
	</div>
	
		<div class="article-img" style="background-image: url('https://img.mukewang.com/5ed9fd58000146ea06400359.jpg')"></div>
	
	
		<a href="/read/80">
			<div class="course-entry">
				<img src="https://img4.mukewang.com/5458620000018a2602200220-40-40.jpg" alt="陈子兴">
				<h3>零基础学透网络编程</h3>
				<p>陈子兴 · 资深软件架构师</p>
				<i class="imwap-arrow_r"></i>
			</div>
		</a>
	
	
		<div class="lead-motto">
			<div class="content">青年是学习智慧的时期，中年是付诸实践的时期。 <p class="author">—— 卢梭</p></div>
		</div>
	
	
		<div class="content" id="article_content">
			
			<div class="cl-preview-section"><h2 id="前言">前言</h2>
</div><div class="cl-preview-section"><p>到目前为止，我们已经学习了 TCP、UDP、UNIX 域套接字等协议的 Socket 编程，我们也学习了如何通过 Socket 选项来控制 Socket 的行为。然而，这些都是围绕 Socket 进行的，属于抽象层面的或者是软件层面的内容，属于 TCP/IP 协议栈中<strong>应用层</strong>、<strong>传输层</strong>、<strong>网络层</strong>的内容。对于 TCP/IP 协议栈中<strong>链路层</strong>的内容，我们仅仅是在第三篇中学习了基本原理。那么 TCP/IP 协议栈是否提供 API 能够让程序员操作硬件设备呢？其实 Linux 操作系统为应用程序提供了 ioctl 系统调用，可以用来操作硬件设备。ioctl 不仅可以控制网卡，也可以控制计算机中其他 I/O 设备。本文将从以下三个主题展开介绍。</p>
</div><div class="cl-preview-section"><ul>
<li>ioctl 函数介绍</li>
<li>通过 ioctl 操作网络设备</li>
<li>如何监控系统网卡状态</li>
</ul>
</div><div class="cl-preview-section"><p>首先，我们了解一下 ioctl 函数的调用方式。</p>
</div><div class="cl-preview-section"><h2 id="ioctl-函数介绍">ioctl 函数介绍</h2>
</div><div class="cl-preview-section"><p>ioctl 函数是一个系统调用，用于控制计算机各个硬件设备，所有 Unix-Like 系统都支持此函数。下来我们以 linux 系统为例，对 ioctl 函数做一个说明，函数声明如下：</p>
</div><div class="cl-preview-section"><pre class="  language-c"><code class="prism  language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;sys/ioctl.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">ioctl</span><span class="token punctuation">(</span><span class="token keyword">int</span> fd<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">long</span> request<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
</div><div class="cl-preview-section"><ul>
<li>函数返回值。如果调用成功，函数返回大于或者等于 0 的整数；如果调用失败，函数返回 -1，可以通过 errno 查看具体错误原因；</li>
<li>参数 fd，是一个打开的文件描述符。需要注意的是，不一定是 Socket 文件描述符，可以是其他设备的文件描述符；</li>
<li>参数 request，是一个设备相关的请求码，是系统定义的一组枚举值。拿 linux 系统来说，所有的请求码可以参考 <a href="http://man7.org/linux/man-pages/man2/ioctl_list.2.html" title="ioctl_list">ioctl_list</a>。</li>
</ul>
</div><div class="cl-preview-section"><p>下来我们对 ioctl 的第二个参数 request 做一个说明：</p>
</div><div class="cl-preview-section"><ul>
<li>请求码按照不同硬件设备进行了分类，举例如下。</li>
</ul>
</div><div class="cl-preview-section"><div class="table-wrapper"><table>
<thead>
<tr>
<th>请求码枚举</th>
<th>硬件设备</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>TCGETS</td>
<td><a href="http://man7.org/linux/man-pages/man4/tty_ioctl.4.html" title="tty">串口和终端设备</a></td>
<td>获取当前串口设备信息请求码</td>
</tr>
<tr>
<td>CDROMPLAYMSF</td>
<td><a href="https://leapster.org/linux/cdrom/" title="cdrom">cdrom 设备</a></td>
<td>播放 cd 请求码</td>
</tr>
<tr>
<td>FDSETPRM</td>
<td><a href="https://linux.die.net/man/4/fd" title="floppydevice">floppy 设备</a></td>
<td>设置软盘媒体信息请求码</td>
</tr>
<tr>
<td>SIOCGIFNAME</td>
<td><a href="http://man7.org/linux/man-pages/man7/netdevice.7.html" title="netdevice">网络设备</a></td>
<td>获取网卡名的请求码</td>
</tr>
</tbody>
</table>
</div></div><div class="cl-preview-section"><p>我们仅仅列出了部分设备的请求码，Linux ioctl 支持的完整列表可以参考 <a href="http://man7.org/linux/man-pages/man2/ioctl_list.2.html" title="ioctl_list">ioctl_list</a>。</p>
</div><div class="cl-preview-section"><ul>
<li>有的请求码只能向系统设置值，有的请求码只能从系统获取值，有的请求码既可以获取值，也可以设置值；</li>
<li>每个请求码对应的数据类型也是不同的，需要参考相关手册来定。 <a href="http://man7.org/linux/man-pages/man2/ioctl_list.2.html" title="ioctl_list">ioctl_list</a> 中只是列出了所有请求码，以及对应的数据类型，但是请求码的说明并没有提供。</li>
</ul>
</div><div class="cl-preview-section"><p>下来我们重点介绍一下网络设备的请求码。</p>
</div><div class="cl-preview-section"><h2 id="通过-ioctl-操作网络设备">通过 ioctl 操作网络设备</h2>
</div><div class="cl-preview-section"><p>当你打开 Linux 命令行执行 man 7 netdevice，或者参考官方手册 <a href="http://man7.org/linux/man-pages/man7/netdevice.7.html" title="netdevice">net device</a>，可以看到有关网络设备的请求码。由于请求码很多，我们仅展示几个常用的请求码，如下：</p>
</div><div class="cl-preview-section"><div class="table-wrapper"><table>
<thead>
<tr>
<th>请求码枚举值</th>
<th>数据类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>SIOCGIFCONF</td>
<td>struct ifconf</td>
<td>获取当前机器网络接口列表，包含网络接口的名称、网络接口的 IP 地址。</td>
</tr>
<tr>
<td>SIOCGIFNAME</td>
<td>char *</td>
<td>根据网络接口 ifindex 获取网络接口名称。</td>
</tr>
<tr>
<td>SIOCGIFHWADDR</td>
<td>struct ifreq</td>
<td>获取网络接口硬件地址，比如以太网 mac 地址。</td>
</tr>
<tr>
<td>SIOCGIFFLAGS</td>
<td>struct ifreq</td>
<td>获取网络接口状态。</td>
</tr>
<tr>
<td>SIOCGIFADDR</td>
<td>struct ifreq</td>
<td>根据网络接口名称获取 IP 地址。</td>
</tr>
</tbody>
</table>
</div></div><div class="cl-preview-section"><p>要想操作网络设备需要包含 net/if.h 头文件，此文件包含了请求码和对应的数据类型。如下代码片段：</p>
</div><div class="cl-preview-section"><pre class="  language-c"><code class="prism  language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;sys/ioctl.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;net/if.h&gt;</span></span>
</code></pre>
</div><div class="cl-preview-section"><p>struct ifreq 结构是根据网络接口名称，获取或者配置网络接口的某个参数，一次只能操作一个网络接口。</p>
</div><div class="cl-preview-section"><pre class="  language-c"><code class="prism  language-c"><span class="token keyword">struct</span> ifreq <span class="token punctuation">{</span>
    <span class="token keyword">char</span> ifr_name<span class="token punctuation">[</span>IFNAMSIZ<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">/*网络接口名称 */</span>
    <span class="token keyword">union</span> <span class="token punctuation">{</span>
        <span class="token keyword">struct</span> sockaddr ifr_addr<span class="token punctuation">;</span> <span class="token comment">// IP 地址</span>
        <span class="token keyword">struct</span> sockaddr ifr_dstaddr<span class="token punctuation">;</span><span class="token comment">// 目标 IP 地址</span>
        <span class="token keyword">struct</span> sockaddr ifr_broadaddr<span class="token punctuation">;</span><span class="token comment">// 广播地址</span>
        <span class="token keyword">struct</span> sockaddr ifr_netmask<span class="token punctuation">;</span><span class="token comment">// 网络掩码</span>
        <span class="token keyword">struct</span> sockaddr ifr_hwaddr<span class="token punctuation">;</span> <span class="token comment">// 标志位，比如 UP、DOWN</span>
        <span class="token keyword">short</span>           ifr_flags<span class="token punctuation">;</span><span class="token comment">// 标志位，比如 UP、DOWN</span>
        <span class="token keyword">int</span>             ifr_ifindex<span class="token punctuation">;</span><span class="token comment">// 网络接口索引</span>
        <span class="token keyword">int</span>             ifr_metric<span class="token punctuation">;</span>
        <span class="token keyword">int</span>             ifr_mtu<span class="token punctuation">;</span>
        <span class="token keyword">struct</span> ifmap    ifr_map<span class="token punctuation">;</span>
        <span class="token keyword">char</span>            ifr_slave<span class="token punctuation">[</span>IFNAMSIZ<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">char</span>            ifr_newname<span class="token punctuation">[</span>IFNAMSIZ<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">char</span>           <span class="token operator">*</span>ifr_data<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div><div class="cl-preview-section"><ul>
<li>字段 ifr_name 是网络接口名称，接受的最大长度是 IFNAMSIZ；</li>
<li>struct ifreq 结构包含了一个 union 结构的字段。根据名称可以看出，我们可以获取或者设置 addr（地址），broadaddr（广播地址），netmask（网络掩码），hwaddr（硬件地址，比如以太网 MAC 地址）等。这些不同参数的获取或者是设置，是根据网络掩码来决定的。</li>
</ul>
</div><div class="cl-preview-section"><p>struct ifconf 结构是用于获取网络接口列表的。</p>
</div><div class="cl-preview-section"><pre class="  language-c"><code class="prism  language-c"><span class="token keyword">struct</span> ifconf <span class="token punctuation">{</span>
    <span class="token keyword">int</span>                 ifc_len<span class="token punctuation">;</span> <span class="token comment">/* ifc_buf 的长度 */</span>
    <span class="token keyword">union</span> <span class="token punctuation">{</span>
        <span class="token keyword">char</span>           <span class="token operator">*</span>ifc_buf<span class="token punctuation">;</span> <span class="token comment">/* 由调用者提供的 buffer，用于保存返回结果 */</span>
        <span class="token keyword">struct</span> ifreq   <span class="token operator">*</span>ifc_req<span class="token punctuation">;</span> <span class="token comment">/* 系统返回查询结果 */</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div><div class="cl-preview-section"><p>struct ifconf 结构的用法是：由调用者分配一块指定长度的内存，长度保存在 ifc_len 中，内存地址保存在 ifc_buf 中。系统返回每一个网络接口的信息，信息是以 struct ifreq 数组的形式返回，系统会设置返回结果的字节长度，保存在 ifc_len 字段中。这里需要注意的是，如果系统返回的 ifc_len 值和用户设置的 ifc_len 值相等，那么很有可能用户设置的 ifc_buf 的空间不够大，需要重新扩充 ifc_buf 的大小，再次调用 ioctl 获取网络接口信息，这样才能保证信息的完整度。</p>
</div><div class="cl-preview-section"><p>下来我们就以网络请求码 SIOCGIFCONF 和 SIOCGIFHWADDR 为例，演示一下 ioctl 的调用方法。完整代码保存在“imooc-sock-core-tech\03-16_获取网卡IP地址”目录下。</p>
</div><div class="cl-preview-section"><p><strong>首先</strong>我们需要创建一个 Socket，获取 Socket 文件描述符，因为这是 ioctl 函数的第一个参数。网络地址族我们传入 AF_INET，Socket 类型可以是网络相关的，比如 SOCK_STREAM 或 SOCK_DGRAM。</p>
</div><div class="cl-preview-section"><pre class="  language-c"><code class="prism  language-c"><span class="token number">156</span>     <span class="token keyword">int</span> fd <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token number">157</span>
<span class="token number">158</span>     fd<span class="token operator">=</span><span class="token function">socket</span><span class="token punctuation">(</span>family<span class="token punctuation">,</span> SOCK_DGRAM<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token number">159</span>     <span class="token keyword">if</span><span class="token punctuation">(</span>fd<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">160</span>         <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"socket()"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token number">161</span>         <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token number">162</span>     <span class="token punctuation">}</span>
</code></pre>
</div><div class="cl-preview-section"><p><strong>第二步</strong>就是调用 ioctl 函数，获取网络接口列表。所需要的网络请求码是 SIOCGIFCONF。</p>
</div><div class="cl-preview-section"><pre class="  language-c"><code class="prism  language-c"><span class="token number">113</span>     <span class="token keyword">struct</span> ifreq <span class="token operator">*</span>ifreq <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
<span class="token number">114</span>     <span class="token keyword">struct</span> ifconf ifconf<span class="token punctuation">;</span>
<span class="token number">115</span>     size_t len <span class="token operator">=</span> <span class="token number">512</span><span class="token punctuation">;</span>
<span class="token number">116</span>
<span class="token number">117</span>     ifconf<span class="token punctuation">.</span>ifc_buf <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
<span class="token number">118</span>     ifconf<span class="token punctuation">.</span>ifc_len <span class="token operator">=</span> len<span class="token punctuation">;</span>
<span class="token number">119</span>
<span class="token number">120</span>     <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token number">121</span>         <span class="token keyword">if</span> <span class="token punctuation">(</span>ifconf<span class="token punctuation">.</span>ifc_buf <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token number">122</span>             <span class="token function">free</span><span class="token punctuation">(</span>ifconf<span class="token punctuation">.</span>ifc_buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token number">123</span>             len <span class="token operator">&lt;&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token number">124</span>         <span class="token punctuation">}</span>
<span class="token number">125</span>
<span class="token number">126</span>         ifconf<span class="token punctuation">.</span>ifc_buf <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token number">127</span>         ifconf<span class="token punctuation">.</span>ifc_len <span class="token operator">=</span> len<span class="token punctuation">;</span>
<span class="token number">128</span>
<span class="token number">129</span>         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">ioctl</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> SIOCGIFCONF<span class="token punctuation">,</span> <span class="token operator">&amp;</span>ifconf<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">130</span>             <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"ioctl(SIOCGIFCONF)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token number">131</span>             <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token number">132</span>         <span class="token punctuation">}</span>
<span class="token number">133</span>
<span class="token number">134</span>         <span class="token keyword">if</span> <span class="token punctuation">(</span>ifconf<span class="token punctuation">.</span>ifc_len <span class="token operator">&lt;</span> len<span class="token punctuation">)</span>
<span class="token number">135</span>             <span class="token keyword">break</span><span class="token punctuation">;</span>
<span class="token number">136</span>     <span class="token punctuation">}</span>
<span class="token number">137</span>
<span class="token number">138</span>     <span class="token keyword">int</span> ITEMS <span class="token operator">=</span> ifconf<span class="token punctuation">.</span>ifc_len <span class="token operator">/</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> ifreq<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token number">139</span>
<span class="token number">140</span>     <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> ITEMS<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">141</span>         ifreq <span class="token operator">=</span> <span class="token operator">&amp;</span>ifconf<span class="token punctuation">.</span>ifc_req<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token number">142</span>         <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token number">143</span>         <span class="token function">my_addr_ntop</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>ifreq<span class="token operator">-&gt;</span>ifr_addr<span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token number">144</span>         <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"ifname:%s   ifaddr:%s\n"</span><span class="token punctuation">,</span> ifreq<span class="token operator">-&gt;</span>ifr_name<span class="token punctuation">,</span> buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token number">145</span>     <span class="token punctuation">}</span>
</code></pre>
</div><div class="cl-preview-section"><ul>
<li>第 113 行是声明一个 struct ifreq * 类型的指针变量，目的是为了遍历每一个网络接口信息；</li>
<li>第 114 行是声明一个 struct ifconf 类型的变量，这是 SIOCGIFCONF 请求码对应的数据类型；</li>
<li>第 115 行是定义一个 ifconf.ifc_buf 的初始大小；</li>
<li>第 117 ~ 118 行是对 ifconf 参数进行初始化；</li>
<li>第 120 ~ 136 行只是分配一块内存，传给 ifconf-&gt;ifc_buf，然后在第 129 行调用 ioctl 函数。然而我们写了一个循环折腾半天，目的就是处理系统返回的 ifconf-&gt;ifc_len 长度和我们设置的初始长度相等的情况；</li>
<li>第 138 ~ 145 行是以数组的形式处理 ioctl 的返回值。数组元素的类型是 struct ifreq，数组每一个元素都对应一个网络接口。SIOCGIFCONF 返回的网络接口信息包含了网络接口名称，网络接口的 IP 地址。通过 struct ifreq 的 ifr_name 字段获取网络接口名称，通过它的 ifr_addr 字段获取网络接口地址。我们在第 143 进行了网络地址转换，熟悉吗？在第 144 行打印了网络接口名称和网络接口地址。</li>
</ul>
</div><div class="cl-preview-section"><p><strong>第三步</strong>就是根据网络接口名称获取网络接口的 flags 信息，所需要的网络请求码是 SIOCGIFFLAGS，代码片段如下：</p>
</div><div class="cl-preview-section"><pre class="  language-c"><code class="prism  language-c"> <span class="token number">71</span>     <span class="token keyword">struct</span> ifreq ifreq<span class="token punctuation">;</span>
 <span class="token number">72</span>
 <span class="token number">73</span>     <span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>ifreq<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span> ifreq<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token number">74</span>     <span class="token function">strncpy</span><span class="token punctuation">(</span>ifreq<span class="token punctuation">.</span>ifr_name<span class="token punctuation">,</span> name<span class="token punctuation">,</span> IFNAMSIZ<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token number">75</span>
 <span class="token number">76</span>     <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">ioctl</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> SIOCGIFFLAGS<span class="token punctuation">,</span> <span class="token operator">&amp;</span>ifreq<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token number">77</span>         <span class="token function">perror</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token number">78</span>         <span class="token keyword">return</span><span class="token punctuation">;</span>
 <span class="token number">79</span>     <span class="token punctuation">}</span>
 <span class="token number">80</span>
 <span class="token number">81</span>     <span class="token keyword">short</span> flags <span class="token operator">=</span> ifreq<span class="token punctuation">.</span>ifr_flags<span class="token punctuation">;</span>
 <span class="token number">82</span>     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Flags:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token number">83</span>     <span class="token keyword">if</span> <span class="token punctuation">(</span>flags <span class="token operator">&amp;</span> IFF_UP<span class="token punctuation">)</span><span class="token punctuation">{</span>
 <span class="token number">84</span>         <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"UP,"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token number">85</span>     <span class="token punctuation">}</span>
 <span class="token number">86</span>
 <span class="token number">87</span>     <span class="token keyword">if</span> <span class="token punctuation">(</span>flags <span class="token operator">&amp;</span> IFF_BROADCAST<span class="token punctuation">)</span><span class="token punctuation">{</span>
 <span class="token number">88</span>         <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"BROADCAST,"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token number">89</span>     <span class="token punctuation">}</span>
 <span class="token number">90</span>
 <span class="token number">91</span>     <span class="token keyword">if</span> <span class="token punctuation">(</span>flags <span class="token operator">&amp;</span> IFF_LOOPBACK<span class="token punctuation">)</span><span class="token punctuation">{</span>
 <span class="token number">92</span>         <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"LOOPBACK,"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token number">93</span>     <span class="token punctuation">}</span>
 <span class="token number">94</span>
 <span class="token number">95</span>     <span class="token keyword">if</span> <span class="token punctuation">(</span>flags <span class="token operator">&amp;</span> IFF_RUNNING<span class="token punctuation">)</span><span class="token punctuation">{</span>
 <span class="token number">96</span>         <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"RUNNING,"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token number">97</span>     <span class="token punctuation">}</span>
 <span class="token number">98</span>
 <span class="token number">99</span>     <span class="token keyword">if</span> <span class="token punctuation">(</span>flags <span class="token operator">&amp;</span> IFF_PROMISC<span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token number">100</span>         <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"PROMISC,"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token number">101</span>     <span class="token punctuation">}</span>
<span class="token number">102</span>
<span class="token number">103</span>     <span class="token keyword">if</span> <span class="token punctuation">(</span>flags <span class="token operator">&amp;</span> IFF_MULTICAST<span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token number">104</span>         <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"MULTICAST"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token number">105</span>     <span class="token punctuation">}</span>
<span class="token number">106</span>
<span class="token number">107</span>     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token number">108</span> <span class="token punctuation">}</span>
</code></pre>
</div><div class="cl-preview-section"><p>获取网络接口的 flags 比较简单，我们就不再介绍每一行代码了。请求码 SIOCGIFFLAGS 所需要的类型是 struct ifreq，在调用 ioctl 函数之前，调用者需要对此结构进行初始化，同时需要传入网络接口名称。你是否发现很多系统调用都需要对参数进行初始化呢？函数调用的返回结果是一组网络接口的 flags，这些 flags 由一些枚举值按照“按位 |”的方式组织起来的，比如 IFF_BROADCAST | IFF_UP 等，由系统保存在 struct ifreq 的 ifr_flags 字段，应用程序需要检测 ifr_flags 是否包含对应的标志位。关于 flags 的相关枚举值，可以参考<a href="http://man7.org/linux/man-pages/man7/netdevice.7.html" title="netdevice">网络设备</a>。</p>
</div><div class="cl-preview-section"><p>关于 ioctl() 函数的调用方法，我们就介绍到这里。客户端网络应用程序所需的一个通用逻辑是监控当前网络接口的连接状态，比如网络连接断开、或者又重新连接等状态，都需要给用户一个提示的。那我们如何来监控网络接口状态呢？</p>
</div><div class="cl-preview-section"><h2 id="如何监控系统网卡状态">如何监控系统网卡状态</h2>
</div><div class="cl-preview-section"><p>监控网络接口状态是一个非常普遍的需求，很多客户端网络应用程序都需要此功能。为此，很多操作系统都为用户提供了非常易用的接口，当然不同的操作系统提供的 API 也有很大的差异。目前看来，主流的两种实现方式是<strong>系统异步通知</strong>和<strong>应用主动轮询</strong>，如下图所示：</p>
</div><div class="cl-preview-section"><p><img src="https://img.mukewang.com/5ed9a86f0001825311580631.png" alt="图片描述"></p>
</div><div class="cl-preview-section"><p>图中左边所示是系统异步通知方式，应用程序需要实现一个 Callback 或者是一个 Receiver 接口，然后调用系统提供的注册（Register）接口注册给系统。当网络状态发生变化时，系统会通过 Callback 或者是 Receiver 通知给应用程序。</p>
</div><div class="cl-preview-section"><p>图中右边所示是应用程序主动轮询方式，应用程序需要自己开启一个线程，并且每隔一个时间周期，主动调用获取网络接口状态的系统 API，然后检测网络接口的状态。</p>
</div><div class="cl-preview-section"><p>相比以上两种方式，异步通知机制对于应用程序来说会更友好一些。</p>
</div><div class="cl-preview-section"><p>下来我们分别介绍一下在 Linux、Windows、Android、IOS/Mac OS 系统下，如何监控网络接口状态。本文不会提供完整代码实现，只是提供一个思路。</p>
</div><div class="cl-preview-section"><h3 id="linux-系统监控网卡状态">Linux 系统监控网卡状态</h3>
</div><div class="cl-preview-section"><p>貌似基于 Linux 系统的客户端应用程序比较少，Linux 系统不是一个大众消费系统，所以作者并没有开发过 Linux 系统下的客户端应用程序。不过，前面小节已经讨论了 ioctl 函数的调用方法，如果我们采用<strong>应用主动轮询</strong>的方式，可以实现监控网络接口状态。思路如下：</p>
</div><div class="cl-preview-section"><ul>
<li>首先开启一个线程，定时调用 ioctl 函数；</li>
<li>第二，我们通过网络请求码 SIOCGIFFLAGS 来获取网络接口的 flags，然后检测 IFF_RUNNING 标志位，如果包含此标志位，说明网卡工作状态正常，否则是异常；</li>
<li>最后，将网络状态通知给应用展示程序。</li>
</ul>
</div><div class="cl-preview-section"><p>另外 Linux 提供了 netlink 套接字，用于 Linux 应用程序在用户空间和内核空间之间进行通信，为此通过 netlink 也可以获取网卡的状态。关于 netlink 的工作方式，又是很大一个主题，详情可以参考<a href="http://man7.org/linux/man-pages/man7/netlink.7.html" title="netlink">linux 帮助</a>。</p>
</div><div class="cl-preview-section"><h3 id="windows-系统监控网卡状态">Windows 系统监控网卡状态</h3>
</div><div class="cl-preview-section"><p>在 Windows 系统下，我们也得采用<strong>应用主动轮询</strong>的方式监控网络接口状态，思路如下：</p>
</div><div class="cl-preview-section"><ul>
<li>创建一个主动事件监听线程，调用 Widows 系统 API NotifyAddrChange 注册监听网络地址变化的事件；</li>
<li>调用 Widows 系统 API WaitForMultipleObjects 等待网络地址变化事件；</li>
<li>当 WaitForMultipleObjects 返回后，调用 Widows 系统 API GetAdaptersAddresses 函数，获取网络接口信息。此函数通过 PIP_ADAPTER_ADDRESSES 类型的参数返回网络接口信息；</li>
<li>检查 PIP_ADAPTER_ADDRESSES 结构的 OperStatus 字段，如果取值是 IfOperStatusUp 表示网络状态正常；</li>
<li>最后，将网络状态通知给应用展示程序。</li>
</ul>
</div><div class="cl-preview-section"><p>关于以上几个 Windows 系统 API 的用法可以参考 MSDN。</p>
</div><div class="cl-preview-section"><h3 id="android-系统监控网卡状态">Android 系统监控网卡状态</h3>
</div><div class="cl-preview-section"><p>Android 系统提供了<strong>系统异步通知</strong>的方式来实现网络接口状态监控，思路如下：</p>
</div><div class="cl-preview-section"><ul>
<li>首先应用程序要实现 android.content.BroadcastReceiver 接口，需要覆盖 onReceive 方法。</li>
</ul>
</div><div class="cl-preview-section"><pre class="  language-java"><code class="prism  language-java">	<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConnectReceiver</span> <span class="token keyword">extends</span> <span class="token class-name">BroadcastReceiver</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onReceive</span><span class="token punctuation">(</span>Context context<span class="token punctuation">,</span> Intent intent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			String action <span class="token operator">=</span> intent<span class="token punctuation">.</span><span class="token function">getAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>action <span class="token operator">!=</span> null <span class="token operator">&amp;&amp;</span> action<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>CONNECTIVITY_CHANGE_ACTION<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Status changed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
</code></pre>
</div><div class="cl-preview-section"><ul>
<li>然后需要构造 android.content.IntentFilter 类对象，调用 Context 的 registerReceiver 方法注册给系统。</li>
</ul>
</div><div class="cl-preview-section"><pre class="  language-java"><code class="prism  language-java">	IntentFilter filter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntentFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	filter<span class="token punctuation">.</span><span class="token function">addAction</span><span class="token punctuation">(</span>CONNECTIVITY_CHANGE_ACTION<span class="token punctuation">)</span><span class="token punctuation">;</span>
	filter<span class="token punctuation">.</span><span class="token function">setPriority</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	ctx<span class="token punctuation">.</span><span class="token function">registerReceiver</span><span class="token punctuation">(</span>conn_receiver_<span class="token punctuation">,</span> filter<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
</div><div class="cl-preview-section"><ul>
<li>当网络接口状态发生变化时，系统会调用 BroadcastReceiver 的 onReceive 方法来通知给应用程序。</li>
</ul>
</div><div class="cl-preview-section"><h3 id="iosmac-os-系统监控网卡状态">IOS/Mac OS 系统监控网卡状态</h3>
</div><div class="cl-preview-section"><p>IOS/Mac OS 系统提供了 SCNetworkReachabilityRef 接口来监控当前主机的网络状态，此接口同时支持<strong>系统异步通知</strong>和<strong>应用主动轮询</strong>两种方式。我们就讲一下<strong>系统异步通知</strong>方式的实现思路：</p>
</div><div class="cl-preview-section"><ul>
<li>调用系统 API SCNetworkReachabilityCreateWithName 创建一个 SCNetworkReachabilityRef 实例；</li>
<li>调用系统 API SCNetworkReachabilitySetCallback 注册 Callback 给系统；</li>
<li>调用系统 API SCNetworkReachabilityScheduleWithRunLoop 启动事件循环。</li>
</ul>
</div><div class="cl-preview-section"><h2 id="总结">总结</h2>
</div><div class="cl-preview-section"><p>本文我们介绍了 ioctl 函数的调用方法，ioctl 是所有 Unix-Like 系统都支持的一个系统调用，用于操作硬件设备的。我们重点介绍了通过 ioctl 操作网络设备的方法。其实 ioctl 的调用很简单，主要是需要阅读各种设备相关的请求码说明手册，搞清楚了请求码的功能和对应的数据类型，一切就很简单了。</p>
</div><div class="cl-preview-section"><p>最后我们介绍了网络应用程序中监控网络接口状态的方法，我们介绍了两种常用的方法是<strong>系统异步通知</strong>和<strong>应用主动轮询</strong>。由于每一种平台的实现都有差异，所以我们只是提供了实现思路，没有提供完整的实现代码。如果你有需要，可以根据本文提供的思路，再查阅一些资料，很快就能解决。在实际应用中，如果系统提供了<strong>系统异步通知</strong>方式，那么首选异步方式，因为异步方式实现简单，不需要过多的控制逻辑。</p>
</div><div class="cl-preview-section"><p>到目前为止，我们已经学习了很多系统 API，有没有发现这些系统 API 都需要在调用之前对传入的参数进行初始化呢？其实不管是写什么样的程序，对参数进行初始化是非常好的编程习惯，需要慢慢体会。</p>
</div><div class="cl-preview-section"><h2 id="思考时间">思考时间</h2>
</div><div class="cl-preview-section"><ol>
<li>请在 Linux 系统下面编写程序，通过 ioctl 函数监控网卡状态，需要有实时监控网卡状态变化。（比如，每隔 500 毫秒获取一次网卡状态）</li>
</ol>
</div>
			
		</div>
	
	
	<div class="finish-learn">
		<p class="copyright">©版权归慕课网所有，未经许可不得转载</p>
		
		
		
		<div class="ad_pic">
			<img src="https://img2.mukewang.com/5ed9fd5d000109e706700192.jpg">
		</div>
		
		
		
		
	</div>
	<div class="comment-con">
		<h4 class="title">
			精选留言
			
				<a href="javascript: void(0);" class="add-comment js-comment-click"><i class="imwap-xieliuyan"></i><span>写留言</span></a>
			
		</h4>
		
			<p class="bottom-text empty">暂无精选留言</p>
		
	</div>
	
	

	
		
	
	
	
		<div class="bottom-con">
			
			
				<div class="inner">
					
						<div class="price-con js-price-con">
							<span class="now">￥58.00</span>
						</div>
							
					
					
					<a class="gobuy js-gobuy" href="//m.imooc.com/account/login?backurl=//m.imooc.com/confirmorder?type=30&typeid=80">
					
						立即购买
					</a>  
				</div>
			
		</div>
	
	<div class="layer-catalog js-layer-catalog hide">
		<div class="layer-title clearfix">
			<div class="l">
				课程目录
			</div>
			
		</div>
		<div class="layer-wrap">
			<div class="js-catalog-container">
			</div>
		</div>
	</div>
	<div class="layer-comment">
		<div class="inner">
			<h5>
				<span class="btn l js-cancel-comment">取消</span>
				评论
				<span class="btn r js-send-comment">发送</span>
			</h5>
			<textarea id="comment-txt" maxlength="20000" placeholder="欢迎在这里发表留言，作者筛选后可公开显示"></textarea>
		</div>
	</div>


            </div>
        </div>
        
            
         
        
        
        
        




<script>
	// 设置字号大小及选中
	(function() {
			var fs = window.localStorage.getItem('font-size') || 'normal';
			var $c = document.querySelector('#middle>.content');
			var $points = document.querySelectorAll('.setting-box .point');
			try{
				// 抢读完了时 该元素不渲染 会有报错
				$c.className = 'content ' + fs;
				for(var i = 0; i < $points.length; i++) {
					if($points[i].className.indexOf(fs) > -1) {
						$points[i].className = $points[i].className + ' current';
					}
				}
			} catch(e) {}
			
	})();
</script>

<script type="text/javascript">
	window.onload = function() {
			zhuge.track('LearnCourse', {
					'Category': '专栏',
					'Name': '17 网卡监控：如何获取网卡的状态信息呢？',
					'CID': '2106',
					'Teacher': '陈子兴'
			});
	}
</script>

        
            <script type="text/javascript">
                var shareData = { 
                    title:  "17 网卡监控：如何获取网卡的状态信息呢？",
                    desc: "学好通用知识，提升技术竞争力",
                    imgUrl: 'https:https://img3.mukewang.com/5ed8c1c600015fc805400720.jpg',
                    otherImgUrl: 'https://img3.mukewang.com/5ed8c1c600015fc805400720.jpg',
                    text: '我正在参加@慕课网的课程，很不错哦！快来一起学习吧！',
                    // url: 'https://www.imooc.com' + window.location.pathname + window.location.search
                    url: 'https://m.imooc.com/read/80',
                    link: 'https://m.imooc.com/read/80'
                }
            </script>
            
        
        <div style="display:none;">
            <!-- 百度统计 -->
            <script>
            var _hmt = _hmt || [];
            (function() {
              var hm = document.createElement("script");
              hm.src = "https://hm.baidu.com/hm.js?c92536284537e1806a07ef3e6873f2b3";
              var s = document.getElementsByTagName("script")[0];
              s.parentNode.insertBefore(hm, s);
            })();
            </script>

            <script>
            (function(){
                var bp = document.createElement('script');
                var curProtocol = window.location.protocol.split(':')[0];
                if (curProtocol === 'https') {
                    bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
                }
                else {
                    bp.src = 'http://push.zhanzhang.baidu.com/push.js';
                }
                var s = document.getElementsByTagName("script")[0];
                s.parentNode.insertBefore(bp, s);
            })();
            </script>
        </div>
        
    <script type="text/javascript" src="https://m.imooc.com/static/wap/static/lib/zhugeio/init_f9752c3.js"></script><script type="text/javascript" src="https://m.imooc.com/static/wap/static/common/js/jquery-2.1.0.min_ac9f840.js"></script><script type="text/javascript" src="https://m.imooc.com/static/wap/static/common/js/common_84429c0.js"></script><script type="text/javascript" src="https://m.imooc.com/static/wap/static/lib/juicer/juicer.min_8643248.js"></script><script type="text/javascript" src="https://m.imooc.com/static/wap/static/lib/previewImage/previewImage.min_43b970d.js"></script><script type="text/javascript" src="https://m.imooc.com/static/wap/static/common/js/msg_bed8d10.js"></script><script type="text/javascript" src="https://m.imooc.com/static/wap/static/js/read/7.2.8/article_30e5762.js"></script><script type="text/javascript" src="https://m.imooc.com/static/wap/static/js/course/advertisementReport_6e58a98.js"></script></body>
</html>
