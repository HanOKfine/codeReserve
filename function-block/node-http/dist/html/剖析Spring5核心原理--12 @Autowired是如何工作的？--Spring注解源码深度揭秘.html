<!doctype html>
<html lang="zh_CN">

    

    

    
    
    
    <head>
        
        <title>12 @Autowired是如何工作的？--Spring注解源码深度揭秘</title>
        
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="description" content="Java工程师提升必修课">
        <meta name="keywords" content="慕课网">
        <meta name="author" content="">
        <meta name = "format-detection" content="telephone=no">
        <meta http-equiv="Cache-Control" content="no-transform " />
        <meta http-equiv="Cache-Control" content="no-siteapp" />
        <link rel="shortcut icon" href="https://m.imooc.com/static/wap/static/favicon.ico" />
        
        
        
        <script type="text/javascript" src="https://m.imooc.com/static/wap/static/common/js/flexible.js"></script>
        
        <script type="text/javascript">
            var userInfo = "";
            
                var isApp = 0;
            
        </script>
         
<!-- 专栏首页列表模板 -->
<script type="text/template" id="index-list-tpl">
<ul class="list-con">
    {@each data.data as item}
        <li>
            <a href="/read/${item.id}" class="item clearfix">
                <div class="img l" style="background-image: url(${item.app_pic1})">
                    {@if item.is_new }
                        <div class="icon new">
                            上新
                        </div>
                    {@else if item.is_marking} 
                        <div class="icon">
                            经典
                        </div>
                    {@/if} 
                </div>
                <div class="text-con l">
                    <div class="title">
                        ${item.title}
                    </div>
                    <div class="desc">
                        ${item.chapter_num}节 · ${item.description}
                    </div>
                     <div class="user-info">
                        ${item.nickname}
                        {@if item.author_title }
                        <span class="dot">
                            ·
                        </span>
                        ${item.author_title}
                        {@/if}
                    </div>
                    <div class="info clearfix">
                    {@if !item.isBuy } 
                        <!-- 未购买才显示 -->
                        <div class="price-con l">
                        {@if item.open_discount == "1" }
                            <span class="now">￥${item.pay_price}</span>
                            <span class="ori">￥${item.price}</span>
                            <p class="sale">${item.discount_name}</p>
                        {@else}
                            <span class="now">￥${item.price}</span>
                        {@/if}
                        </div>
                    {@/if}
                        <div class="taste-con r">
                            <span>${item.numbers}人订阅</span>
                            {@if !item.isBuy }
                                <span class="gotaste">试读</span>
                            {@else}
                                <span class="gotaste">学习</span>
                            {@/if}
                        </div>
                    </div>
                </div>
            </a>
        </li>
    {@/each}
</ul>
</script>



<!-- 专栏目录 买后目录页、 -->
<script type="text/template" id="detail-catalog-tpl">
<ul class="catalog-list">
{@each data.list as item}
    <li class="zhang">
        {@if data.structure_mode == "1" }
            <!--章节模式-->
            <div class="zhang-title">
                ${item.title}（${item.count}节）
            </div>
            <div class="zhang-sub-title">
                ${item.short_introduce}
            </div>
        {@/if}  
        <ul class="zhang-detail">
            {@each item.list as it,i}
                <li class="jie">
                    {@if data.isLogin }
                        <!-- 购买了  -->
                        {@if data.isBuy }
                        <a href="javascript:;" data-link="/read/${data.column_id}/article/${it.id}" class="js-go-read">
                        {@else}
                        <a href="javascript:;" data-link="/read/${data.column_id}/article/${it.id}" class="js-go-read" >
                        {@/if}
                    {@else}
                        <!-- 未登录  -->
                        {@if data.isApp }
                            <a href="javascript:;" onclick="window.nativeSupport.login();">
                        {@else}
                            <a href="//m.imooc.com/account/login?backurl=/read/${data.column_id}">
                        {@/if}
                    {@/if}
                        <div class="jie-con {@if data.last_chapter == it.id }recent{@/if}">
                            
                            <div class="text-con">
                                <div class="jie-title">
                                    ${it.title}
                                </div>
                                <div class="jie-status">
                                    {@if it.is_open == "0" }
                                        <span class="update-time" >${it.open_time_fmt}</span>
                                    {@/if}
                                    {@if it.view_num > 100 }
                                    <div class="learn-num">
                                        <i class="imwap-set-sns"></i>
                                        <span>${it.view_num}</span>
                                    </div>
                                    {@/if}
                                    {@if it.in_24hours == "1" }
                                        <span class="update-recent">最近更新</span>
                                    {@/if}
                                </div>
                            </div>
                        </div>
                        {@if it.is_learned }
                            <div class="jie-right haslearn is_learned js-learn" data-type="1">
                                已学
                            </div>
                        {@else}
                            <!-- 购买了  -->
                            {@if data.isBuy }
                                <div class="jie-right learn js-learn" data-type="1">
                                    学习
                                </div>
                            {@else}
                                {@if it.is_pay == "0" }
                                <!--免费小节 不占用试读次数  -->
                                    <div class="jie-right learn js-learn" data-type="1">
                                        免费
                                    </div>
                                {@else}
                                    <div class="jie-right learn js-learn" data-type="0">
                                        学习
                                    </div>
                                {@/if}
                            {@/if}
                            
                            
                        {@/if}
                    </a>
                </li>
            {@/each}
        </ul>
    </li>
{@/each}
</ul>
</script> 

<!-- 阅读页 阅读页   专栏目录  -->
<script type="text/template" id="catalog-tpl">
<div>
    <h2 class="article-title">${data.a_name}</h2>
    <ul class="catalog">
    {@each data.list as item}
        <li class="zhang">
            {@if data.structure_mode == "1" }
                <!--章节模式-->
                <div class="zhang-title">
                    ${item.title}
                    <!-- <div class="num">共${item.count}节</div> -->
                </div>
            {@/if}  
            <ul class="zhang-detail">
                {@each item.list as it,i}
                    <li class="jie">
                        <!--买了且开放的-->
                        <a href="/read/${data.column_id}/article/${it.id}">
                            <div class="jie-title clearfix full">
                                <p>
                                    {@if data.last_chapter == it.id }
                                        <span class="recent">最近阅读</span>
                                    {@/if}
                                    ${it.title}
                                </p>
                            </div>
                        </a>
                    </li>
                {@/each}
            </ul>
        </li>
    {@/each}
    </ul>
</div>
</script>





<script type="text/javascript">
	var isApp = "";
	var clientVersion = "0";
	var count_num = "0";
	var chapter_id = "2026";
	var chapter_title = "12 @Autowired是如何工作的？--Spring注解源码深度揭秘";
	var aid = "77";
	var a_name = "剖析Spring5核心原理";
	var a_price = "68.00";
	var a_pic = "https://img2.mukewang.com/5ec1f3830001652c05400720.jpg";
	var userId = 0;

	var column_id = '77';
	var isLogin = 0;
	

</script>
<!-- 引入字体 -->
<script type="text/javascript" src="//cdn.webfont.youziku.com/wwwroot/js/wf/youziku.api.min.js"></script>
<script type="text/javascript">
$youziku.load(".top-con .title, .cl-preview-section h1,.cl-preview-section h2,.cl-preview-section h3,.cl-preview-section h4,.cl-preview-section h5,.cl-preview-section h6", "37af461390fa4d138f5c3d277f7286dc", "SourceHanSerifSC-Heavy"); // 思源宋体heavy
$youziku.load(".lead-motto, .cl-preview-section blockquote", "d9a0d855583142c3b2cc3bf1646a8473", "SourceHanSerifSC-Regular"); // 思源宋体regular
$youziku.load("#article_content, .cl-preview-section pre, .cl-preview-section code, #code-copy", "3d84aabcf9e44b6f8c6fa91c61fa926e", "HYQiHei-55S"); // 汉仪旗黑55s
$youziku.load(".cl-preview-section strong", "fd94fff3a17546a28913a79613bddcec", "HYQiHei-77S"); // 汉仪旗黑70s

$youziku.draw();
</script>

<style type="text/css">
  header{
    display: none!important;
  }
  
  #wrapper{
  	padding-top:0px !important;
  }
  
</style>



    <link rel="stylesheet" href="https://m.imooc.com/static/wap/static/common/css/common_d42b1ef.css" /><link rel="stylesheet" href="https://m.imooc.com/static/wap/static/css/read/7.2.8/article_2d28313.css" /></head>
    <body >
        
          
        

        
          
        

        
          







<header class="directory2">
	<div class="header clearfix">
		
			
				<div class="page-title clearfix">
					<a href="//m.imooc.com" class="imwap-icon-imooc"></a>
					<div class="page-title-name js-page-name">
						<span>专栏</span>
						<i class="imwap-arrow_d"></i>
					</div>
				</div>
			

			
			<div class="drawer-box js-drawer-more">
				<i class="imwap-more_vert"></i>
				<div class="drawer-content js-drawer-content">
					<p class="line-row"></p>
					<a class="drawer-item" href="//m.imooc.com"><i class="imwap-center"></i>回到首页</a>
					<a class="drawer-item" href="//www.imooc.com/m/web/user/usercenter.html"><i class="imwap-peaple"></i>个人中心</a>
					<a class="drawer-item" href="//m.imooc.com/feedback"><i class="imwap-comment"></i>反馈问题</a>
					
					<a class="drawer-item" href="//m.imooc.com/account/login"><i class="imwap-out"></i>注册登录</a>
					
				</div>
			</div>
			

			
				<a id="js-appload" href="Javascript:;" class="app-load"><span>下载APP</span></a>
			

		
	</div>
	
	<div class="page-tab-wrap">
		<div class="page-tab-list">
			<a href="//m.imooc.com" class="page-tab-item">首页</a>
			<a href="//m.imooc.com/course/list" class="page-tab-item">课程</a>
			<a href="//coding.m.imooc.com" class="page-tab-item">实战</a>
			<a href="//class.m.imooc.com" class="page-tab-item">金职位</a>
			<a href="//m.imooc.com/article" class="page-tab-item">手记</a>
			<a href="//m.imooc.com/read" class="page-tab-item active">专栏</a>
			<a href="//m.imooc.com/wenda" class="page-tab-item">猿问</a>
			<a href="//m.imooc.com/wiki" class="page-tab-item">慕课教程</a>
			
		</div>
	</div>
	
</header>


        

        <div id="wrapper">
            <div id="middle" class="container ">

                

                
	
		
	
	<div class="top-con">
		<p class="update-time"><span>2020-08-04&nbsp;&nbsp;&nbsp;更新</span></p>
		<div class="title">
			12 @Autowired是如何工作的？--Spring注解源码深度揭秘
		</div>
	</div>
	
		<div class="article-img" style="background-image: url('https://img2.mukewang.com/5ece0a0b0001af5306400359.jpg')"></div>
	
	
		<a href="/read/77">
			<div class="course-entry">
				<img src="https://img.mukewang.com/5cfe2ab00001bd1606380638-40-40.jpg" alt="David">
				<h3>剖析Spring5核心原理</h3>
				<p>David · 资深架构师</p>
				<i class="imwap-arrow_r"></i>
			</div>
		</a>
	
	
		<div class="lead-motto">
			<div class="content">人生的价值，并不是用时间，而是用深度去衡量的。<p class="author">——列夫·托尔斯泰</p></div>
		</div>
	
	
		<div class="content" id="article_content">
			
			<div class="cl-preview-section"><h2 id="背景">背景</h2>
</div><div class="cl-preview-section"><p>注解可以减少代码的开发量，Spring 提供了丰富的注解功能。我们可能会被问到，Spring 的注解到底是怎么触发的呢？今天以 Spring 最常使用的一个注解 Autowired 来跟踪代码，进行 debug。</p>
</div><div class="cl-preview-section"><h2 id="autowired-的定义及作用">Autowired 的定义及作用</h2>
</div><div class="cl-preview-section"><p>作用：Marks a constructor, field, setter method or config method as to be autowired by Spring’s dependency injection facilities.</p>
</div><div class="cl-preview-section"><p>定义：</p>
</div><div class="cl-preview-section"><pre class="  language-java"><code class="prism  language-java"> <span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token punctuation">{</span>ElementType<span class="token punctuation">.</span>CONSTRUCTOR<span class="token punctuation">,</span> ElementType<span class="token punctuation">.</span>FIELD<span class="token punctuation">,</span> ElementType<span class="token punctuation">.</span>METHOD<span class="token punctuation">,</span> ElementType<span class="token punctuation">.</span>ANNOTATION_TYPE<span class="token punctuation">}</span><span class="token punctuation">)</span>  
 <span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span>RetentionPolicy<span class="token punctuation">.</span>RUNTIME<span class="token punctuation">)</span>  
 <span class="token annotation punctuation">@Documented</span>  
 <span class="token keyword">public</span> @<span class="token keyword">interface</span> <span class="token class-name">Autowired</span> <span class="token punctuation">{</span>  
  <span class="token comment">/**  
  * Declares whether the annotated dependency is required.  
  * &lt;p&gt;Defaults to {@code true}.  
  */</span>  
  <span class="token keyword">boolean</span> <span class="token function">required</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token boolean">true</span><span class="token punctuation">;</span>  
 <span class="token punctuation">}</span>
</code></pre>
</div><div class="cl-preview-section"><h3 id="target">@Target</h3>
</div><div class="cl-preview-section"><p>@Target 起到什么作用呢？我们来看 jdk 的说明：</p>
</div><div class="cl-preview-section"><blockquote>
<p>Indicates the kinds of program element to which an annotation type is applicable. If a Target meta-annotation is not present on an annotation type declaration, the declared type may be used on any program element. If such a meta-annotation is present, the compiler will enforce the specified usage restriction.</p>
</blockquote>
</div><div class="cl-preview-section"><p>@Target 限定注解可应用于的程序元素的类型。如果目标元注解没有出现在注解类型声明中，则声明的类型可以在任何程序元素上使用。如果存在这样的元注释，编译器将强制执行指定的使用限制。</p>
</div><div class="cl-preview-section"><p>其次，@Target 定义：</p>
</div><div class="cl-preview-section"><pre class="  language-java"><code class="prism  language-java"> <span class="token annotation punctuation">@Documented</span>  
 <span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span>RetentionPolicy<span class="token punctuation">.</span>RUNTIME<span class="token punctuation">)</span>  
 <span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span>ElementType<span class="token punctuation">.</span>ANNOTATION_TYPE<span class="token punctuation">)</span>  
 <span class="token keyword">public</span> @<span class="token keyword">interface</span> <span class="token class-name">Target</span> <span class="token punctuation">{</span>  
  ElementType<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
 <span class="token punctuation">}</span>
</code></pre>
</div><div class="cl-preview-section"><p>注解表明适用于哪种程序元素，程序元素有以下几种：</p>
</div><div class="cl-preview-section"><pre class="  language-java"><code class="prism  language-java"> <span class="token keyword">public</span> <span class="token keyword">enum</span> ElementType <span class="token punctuation">{</span>  
  <span class="token comment">/** Class, interface (including annotation type), or enum declaration */</span>  
  TYPE<span class="token punctuation">,</span>  
  <span class="token comment">/** Field declaration (includes enum constants) */</span>  
  FIELD<span class="token punctuation">,</span>  
  <span class="token comment">/** Method declaration */</span>  
  METHOD<span class="token punctuation">,</span>  
  <span class="token comment">/** Parameter declaration */</span>  
  PARAMETER<span class="token punctuation">,</span>  
  <span class="token comment">/** Constructor declaration */</span>  
  CONSTRUCTOR<span class="token punctuation">,</span>  
  <span class="token comment">/** Local variable declaration */</span>  
  LOCAL_VARIABLE<span class="token punctuation">,</span>  
  <span class="token comment">/** Annotation type declaration */</span>  
  ANNOTATION_TYPE<span class="token punctuation">,</span>  
  <span class="token comment">/** Package declaration */</span>  
  PACKAGE  
 <span class="token punctuation">}</span>
</code></pre>
</div><div class="cl-preview-section"><p>最后，Target 使用方式：</p>
</div><div class="cl-preview-section"><p><code>@Target(value={ANNOTATION_TYPE})</code></p>
</div><div class="cl-preview-section"><h3 id="retention">@Retention</h3>
</div><div class="cl-preview-section"><p>官方说明：</p>
</div><div class="cl-preview-section"><blockquote>
<p>Indicates how long annotations with the annotated type are to be retained. If no Retention annotation is present on an annotation type declaration, the retention policy defaults to RetentionPolicy.CLASS</p>
</blockquote>
</div><div class="cl-preview-section"><p>简单的说就是作用域。</p>
</div><div class="cl-preview-section"><p>然后我们看其定义：</p>
</div><div class="cl-preview-section"><pre class="  language-java"><code class="prism  language-java"> <span class="token annotation punctuation">@Documented</span>  
 <span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span>RetentionPolicy<span class="token punctuation">.</span>RUNTIME<span class="token punctuation">)</span>  
 <span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span>ElementType<span class="token punctuation">.</span>ANNOTATION_TYPE<span class="token punctuation">)</span>  
 <span class="token keyword">public</span> @<span class="token keyword">interface</span> <span class="token class-name">Retention</span> <span class="token punctuation">{</span>  
  RetentionPolicy <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
 <span class="token punctuation">}</span>
</code></pre>
</div><div class="cl-preview-section"><p>RetentionPolicy 作用域定义：</p>
</div><div class="cl-preview-section"><pre class="  language-java"><code class="prism  language-java"> <span class="token keyword">public</span> <span class="token keyword">enum</span> RetentionPolicy <span class="token punctuation">{</span>  
  <span class="token comment">/**  
  * Annotations are to be discarded by the compiler.  
  */</span>  
  SOURCE<span class="token punctuation">,</span>  
  <span class="token comment">/**  
  * Annotations are to be recorded in the class file by the compiler  
  * but need not be retained by the VM at run time. This is the default  
  * behavior.  
  */</span>  
  CLASS<span class="token punctuation">,</span>  
  <span class="token comment">/**  
  * Annotations are to be recorded in the class file by the compiler and  
  * retained by the VM at run time, so they may be read reflectively.  
  *  
  * @see java.lang.reflect.AnnotatedElement  
  */</span>  
  RUNTIME  
 <span class="token punctuation">}</span>
</code></pre>
</div><div class="cl-preview-section"><p>最后，使用方式：</p>
</div><div class="cl-preview-section"><p><code>@Retention(value=RetentionPolicy )</code></p>
</div><div class="cl-preview-section"><h3 id="documented">@Documented</h3>
</div><div class="cl-preview-section"><p>官方说明：</p>
</div><div class="cl-preview-section"><blockquote>
<p>Indicates that annotations with a type are to be documented by javadoc and similar tools by default. This type should be used to annotate the declarations of types whose annotations affect the use of annotated elements by their clients. If a type declaration is annotated with Documented, its annotations become part of the public API of the annotated elements.</p>
</blockquote>
</div><div class="cl-preview-section"><p>简单的说，可以成为 API 的一部分。</p>
</div><div class="cl-preview-section"><p>定义:</p>
</div><div class="cl-preview-section"><pre class="  language-java"><code class="prism  language-java"> <span class="token annotation punctuation">@Documented</span>  
 <span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span>RetentionPolicy<span class="token punctuation">.</span>RUNTIME<span class="token punctuation">)</span>  
 <span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span>ElementType<span class="token punctuation">.</span>ANNOTATION_TYPE<span class="token punctuation">)</span>  
 <span class="token keyword">public</span> @<span class="token keyword">interface</span> <span class="token class-name">Documented</span> <span class="token punctuation">{</span>  
 <span class="token punctuation">}</span>
</code></pre>
</div><div class="cl-preview-section"><p>使用方式：</p>
</div><div class="cl-preview-section"><p>@Documented</p>
</div><div class="cl-preview-section"><h2 id="注解实现类-autowiredannotationbeanpostprocessor-的注册">注解实现类 AutowiredAnnotationBeanPostProcessor 的注册</h2>
</div><div class="cl-preview-section"><p>它的注册方式有两种：</p>
</div><div class="cl-preview-section"><p>一种使用 xml 配置文件方式，即<code>&lt;context:annotation-config/&gt;</code>，它通过 AnnotationConfigBeanDefinitionParser 解析器来将 AutowiredAnnotationBeanPostProcessor 注册到容器中，后面讨论@Resource 注解会详细论述。</p>
</div><div class="cl-preview-section"><p>一种是使用 AnnotationConfigWebApplicationContext 容器来启动应用，通过 AnnotatedBeanDefinitionReader 将 AutowiredAnnotationBeanPostProcessor 注册到容器中。它的注册过程如下：</p>
</div><div class="cl-preview-section"><p><img src="http://p1.pstatp.com/large/pgc-image/81fba39db924461192bb9dfb0185296f" alt="img"></p>
</div><div class="cl-preview-section"><p>注册的注解相关处理器代码如下：</p>
</div><div class="cl-preview-section"><pre class="  language-java"><code class="prism  language-java"><span class="token comment">/**  
* Register all relevant annotation post processors in the given registry.  
* @param registry the registry to operate on  
* @param source the configuration source element (already extracted)  
* that this registration was triggered from. May be {@code null}.  
* @return a Set of BeanDefinitionHolders, containing all bean definitions  
* that have actually been registered by this call  
*/</span>  
<span class="token keyword">public</span> <span class="token keyword">static</span> Set<span class="token operator">&lt;</span>BeanDefinitionHolder<span class="token operator">&gt;</span> <span class="token function">registerAnnotationConfigProcessors</span><span class="token punctuation">(</span>  
BeanDefinitionRegistry registry<span class="token punctuation">,</span> Object source<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
    DefaultListableBeanFactory beanFactory <span class="token operator">=</span> <span class="token function">unwrapDefaultListableBeanFactory</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token keyword">if</span> <span class="token punctuation">(</span>beanFactory <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
     <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>beanFactory<span class="token punctuation">.</span><span class="token function">getDependencyComparator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">instanceof</span> <span class="token class-name">AnnotationAwareOrderComparator</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
     beanFactory<span class="token punctuation">.</span><span class="token function">setDependencyComparator</span><span class="token punctuation">(</span>AnnotationAwareOrderComparator<span class="token punctuation">.</span>INSTANCE<span class="token punctuation">)</span><span class="token punctuation">;</span>  
     <span class="token punctuation">}</span>  
     <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>beanFactory<span class="token punctuation">.</span><span class="token function">getAutowireCandidateResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">instanceof</span>  <span class="token class-name">ContextAnnotationAutowireCandidateResolver</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
     beanFactory<span class="token punctuation">.</span><span class="token function">setAutowireCandidateResolver</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ContextAnnotationAutowireCandidateResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
     <span class="token punctuation">}</span>  
    <span class="token punctuation">}</span>  
    Set<span class="token operator">&lt;</span>BeanDefinitionHolder<span class="token operator">&gt;</span> beanDefs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedHashSet</span><span class="token operator">&lt;</span>BeanDefinitionHolder<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>registry<span class="token punctuation">.</span><span class="token function">containsBeanDefinition</span><span class="token punctuation">(</span>CONFIGURATION_ANNOTATION_PROCESSOR_BEAN_NAME<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
     RootBeanDefinition def <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RootBeanDefinition</span><span class="token punctuation">(</span>ConfigurationClassPostProcessor<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
     def<span class="token punctuation">.</span><span class="token function">setSource</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span>  
     beanDefs<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">registerPostProcessor</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> def<span class="token punctuation">,</span> CONFIGURATION_ANNOTATION_PROCESSOR_BEAN_NAME<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>registry<span class="token punctuation">.</span><span class="token function">containsBeanDefinition</span><span class="token punctuation">(</span>AUTOWIRED_ANNOTATION_PROCESSOR_BEAN_NAME<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
     RootBeanDefinition def <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RootBeanDefinition</span><span class="token punctuation">(</span>AutowiredAnnotationBeanPostProcessor<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
     def<span class="token punctuation">.</span><span class="token function">setSource</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span>  
     beanDefs<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">registerPostProcessor</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> def<span class="token punctuation">,</span> AUTOWIRED_ANNOTATION_PROCESSOR_BEAN_NAME<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>registry<span class="token punctuation">.</span><span class="token function">containsBeanDefinition</span><span class="token punctuation">(</span>REQUIRED_ANNOTATION_PROCESSOR_BEAN_NAME<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
     RootBeanDefinition def <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RootBeanDefinition</span><span class="token punctuation">(</span>RequiredAnnotationBeanPostProcessor<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
     def<span class="token punctuation">.</span><span class="token function">setSource</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span>  
     beanDefs<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">registerPostProcessor</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> def<span class="token punctuation">,</span> REQUIRED_ANNOTATION_PROCESSOR_BEAN_NAME<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
    <span class="token comment">// Check for JSR-250 support, and if present add the CommonAnnotationBeanPostProcessor.  </span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>jsr250Present <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>registry<span class="token punctuation">.</span><span class="token function">containsBeanDefinition</span><span class="token punctuation">(</span>COMMON_ANNOTATION_PROCESSOR_BEAN_NAME<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
     RootBeanDefinition def <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RootBeanDefinition</span><span class="token punctuation">(</span>CommonAnnotationBeanPostProcessor<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
     def<span class="token punctuation">.</span><span class="token function">setSource</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span>  
     beanDefs<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">registerPostProcessor</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> def<span class="token punctuation">,</span> COMMON_ANNOTATION_PROCESSOR_BEAN_NAME<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
    <span class="token comment">// Check for JPA support, and if present add the PersistenceAnnotationBeanPostProcessor.  </span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>jpaPresent <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>registry<span class="token punctuation">.</span><span class="token function">containsBeanDefinition</span><span class="token punctuation">(</span>PERSISTENCE_ANNOTATION_PROCESSOR_BEAN_NAME<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
     RootBeanDefinition def <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RootBeanDefinition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token keyword">try</span> <span class="token punctuation">{</span>  
           def<span class="token punctuation">.</span><span class="token function">setBeanClass</span><span class="token punctuation">(</span>ClassUtils<span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>PERSISTENCE_ANNOTATION_PROCESSOR_CLASS_NAME<span class="token punctuation">,</span>  
           AnnotationConfigUtils<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token punctuation">}</span>  
     <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
     <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span>  
 <span class="token string">"Cannot load optional framework class: "</span> <span class="token operator">+</span> PERSISTENCE_ANNOTATION_PROCESSOR_CLASS_NAME<span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>  
     <span class="token punctuation">}</span>  
     def<span class="token punctuation">.</span><span class="token function">setSource</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span>  
     beanDefs<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">registerPostProcessor</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> def<span class="token punctuation">,</span> PERSISTENCE_ANNOTATION_PROCESSOR_BEAN_NAME<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
    <span class="token keyword">return</span> beanDefs<span class="token punctuation">;</span>  
<span class="token punctuation">}</span>
</code></pre>
</div><div class="cl-preview-section"><p>通过代码，我们可以看到注册的注解处理器有：</p>
</div><div class="cl-preview-section"><p>org.springframework.context.annotation.internalConfigurationAnnotationProcessor 对应于 ConfigurationClassPostProcessor；</p>
</div><div class="cl-preview-section"><p>org.springframework.context.annotation.internalAutowiredAnnotationProcessor 对应于 AutowiredAnnotationBeanPostProcessor；</p>
</div><div class="cl-preview-section"><p>org.springframework.context.annotation.internalRequiredAnnotationProcessor 对应于 RequiredAnnotationBeanPostProcessor；</p>
</div><div class="cl-preview-section"><p>org.springframework.context.annotation.internalCommonAnnotationProcessor 对应于 CommonAnnotationBeanPostProcessor；</p>
</div><div class="cl-preview-section"><p>org.springframework.context.annotation.internalPersistenceAnnotationProcessor 对应于 PersistenceAnnotationBeanPostProcessor；</p>
</div><div class="cl-preview-section"><h2 id="注解实现类-autowiredannotationbeanpostprocessor-使用">注解实现类 AutowiredAnnotationBeanPostProcessor 使用</h2>
</div><div class="cl-preview-section"><p>@Autowired 注解，定义了两种主要的注入类型：</p>
</div><div class="cl-preview-section"><p><strong>1. 基于构造方法注入</strong></p>
</div><div class="cl-preview-section"><p>其调用链如下：</p>
</div><div class="cl-preview-section"><ol>
<li>
<p>AbstractAutowireCapableBeanFactory#createBean()</p>
</li>
<li>
<p>AbstractAutowireCapableBeanFactory#doCreateBean()</p>
</li>
<li>
<p>AbstractAutowireCapableBeanFactory#createBeanInstance()</p>
</li>
<li>
<p>AbstractAutowireCapableBeanFactory#determineConstructorsFromBeanPostProcessors()</p>
</li>
<li>
<p>AutowiredAnnotationBeanPostProcessor#determineConstructorsFromBeanPostProcessors()</p>
</li>
</ol>
</div><div class="cl-preview-section"><p><strong>2. 基于成员变量自动注入</strong></p>
</div><div class="cl-preview-section"><p>其调用链如下：</p>
</div><div class="cl-preview-section"><ol>
<li>
<p>AbstractAutowireCapableBeanFactory#createBean()</p>
</li>
<li>
<p>AbstractAutowireCapableBeanFactory#doCreateBean()</p>
</li>
<li>
<p>AbstractAutowireCapableBeanFactory#populateBean()</p>
</li>
<li>
<p>AutowiredAnnotationBeanPostProcessor#postProcessPropertyValues()</p>
</li>
<li>
<p>InjectionMetadata#inject()</p>
</li>
<li>
<p>AutowiredFieldElement#inject()/AutowiredMethodElement#inject()</p>
</li>
</ol>
</div><div class="cl-preview-section"><h2 id="小结">小结</h2>
</div><div class="cl-preview-section"><p>Spring 框架从创建伊始就致力于为复杂问题提供强大的、非侵入性的解决方案。开始时 Spring 使用 XML 配置文件数量引入定制命名空间功能。从 Spring 2.5 推出了一整套注解，作为基于 XML 的配置的可选方案。注解可用于 Spring 管理对象的自动发现、依赖注入、生命周期方法、Web 层配置和单元/集成测试。</p>
</div><div class="cl-preview-section"><p>Spring 注解确实提高了开发效率，但一直以来，很多开发者对 Spring 注解的工作原理都处于一知半解的状态，使用注解过程中碰到问题，也是通过搜索或者多次尝试的方式来验证，为了更好的工作，还是要把 how Spring annotation works 这件事做起来。</p>
</div>
			
		</div>
	
	
	<div class="finish-learn">
		<p class="copyright">©版权归慕课网所有，未经许可不得转载</p>
		
		
		
		<div class="ad_pic">
			<img src="https://img3.mukewang.com/5ece0a05000109e706700192.jpg">
		</div>
		
		
		
		
	</div>
	<div class="comment-con">
		<h4 class="title">
			精选留言
			
				<a href="javascript: void(0);" class="add-comment js-comment-click"><i class="imwap-xieliuyan"></i><span>写留言</span></a>
			
		</h4>
		
			<p class="bottom-text empty">暂无精选留言</p>
		
	</div>
	
	

	
		
	
	
	
		<div class="bottom-con">
			
			
				<div class="inner">
					
						<div class="price-con js-price-con">
							<span class="now">￥68.00</span>
						</div>
							
					
					
					<a class="gobuy js-gobuy" href="//m.imooc.com/account/login?backurl=//m.imooc.com/confirmorder?type=30&typeid=77">
					
						立即购买
					</a>  
				</div>
			
		</div>
	
	<div class="layer-catalog js-layer-catalog hide">
		<div class="layer-title clearfix">
			<div class="l">
				课程目录
			</div>
			
		</div>
		<div class="layer-wrap">
			<div class="js-catalog-container">
			</div>
		</div>
	</div>
	<div class="layer-comment">
		<div class="inner">
			<h5>
				<span class="btn l js-cancel-comment">取消</span>
				评论
				<span class="btn r js-send-comment">发送</span>
			</h5>
			<textarea id="comment-txt" maxlength="20000" placeholder="欢迎在这里发表留言，作者筛选后可公开显示"></textarea>
		</div>
	</div>


            </div>
        </div>
        
            
         
        
        
        
        




<script>
	// 设置字号大小及选中
	(function() {
			var fs = window.localStorage.getItem('font-size') || 'normal';
			var $c = document.querySelector('#middle>.content');
			var $points = document.querySelectorAll('.setting-box .point');
			try{
				// 抢读完了时 该元素不渲染 会有报错
				$c.className = 'content ' + fs;
				for(var i = 0; i < $points.length; i++) {
					if($points[i].className.indexOf(fs) > -1) {
						$points[i].className = $points[i].className + ' current';
					}
				}
			} catch(e) {}
			
	})();
</script>

<script type="text/javascript">
	window.onload = function() {
			zhuge.track('LearnCourse', {
					'Category': '专栏',
					'Name': '12 @Autowired是如何工作的？--Spring注解源码深度揭秘',
					'CID': '2026',
					'Teacher': 'David'
			});
	}
</script>

        
            <script type="text/javascript">
                var shareData = { 
                    title:  "12 @Autowired是如何工作的？--Spring注解源码深度揭秘",
                    desc: "Java工程师提升必修课",
                    imgUrl: 'https:https://img2.mukewang.com/5ec1f3830001652c05400720.jpg',
                    otherImgUrl: 'https://img2.mukewang.com/5ec1f3830001652c05400720.jpg',
                    text: '我正在参加@慕课网的课程，很不错哦！快来一起学习吧！',
                    // url: 'https://www.imooc.com' + window.location.pathname + window.location.search
                    url: 'https://m.imooc.com/read/77',
                    link: 'https://m.imooc.com/read/77'
                }
            </script>
            
        
        <div style="display:none;">
            <!-- 百度统计 -->
            <script>
            var _hmt = _hmt || [];
            (function() {
              var hm = document.createElement("script");
              hm.src = "https://hm.baidu.com/hm.js?c92536284537e1806a07ef3e6873f2b3";
              var s = document.getElementsByTagName("script")[0];
              s.parentNode.insertBefore(hm, s);
            })();
            </script>

            <script>
            (function(){
                var bp = document.createElement('script');
                var curProtocol = window.location.protocol.split(':')[0];
                if (curProtocol === 'https') {
                    bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
                }
                else {
                    bp.src = 'http://push.zhanzhang.baidu.com/push.js';
                }
                var s = document.getElementsByTagName("script")[0];
                s.parentNode.insertBefore(bp, s);
            })();
            </script>
        </div>
        
    <script type="text/javascript" src="https://m.imooc.com/static/wap/static/lib/zhugeio/init_f9752c3.js"></script><script type="text/javascript" src="https://m.imooc.com/static/wap/static/common/js/jquery-2.1.0.min_ac9f840.js"></script><script type="text/javascript" src="https://m.imooc.com/static/wap/static/common/js/common_84429c0.js"></script><script type="text/javascript" src="https://m.imooc.com/static/wap/static/lib/juicer/juicer.min_8643248.js"></script><script type="text/javascript" src="https://m.imooc.com/static/wap/static/lib/previewImage/previewImage.min_43b970d.js"></script><script type="text/javascript" src="https://m.imooc.com/static/wap/static/common/js/msg_bed8d10.js"></script><script type="text/javascript" src="https://m.imooc.com/static/wap/static/js/read/7.2.8/article_30e5762.js"></script><script type="text/javascript" src="https://m.imooc.com/static/wap/static/js/course/advertisementReport_6e58a98.js"></script></body>
</html>
