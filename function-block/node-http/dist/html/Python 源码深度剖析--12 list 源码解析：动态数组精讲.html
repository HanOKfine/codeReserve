<!doctype html>
<html lang="zh_CN">

    

    

    
    
    
    <head>
        
        <title>12 list 源码解析：动态数组精讲</title>
        
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="description" content="突破技术瓶颈，迈向更高岗位">
        <meta name="keywords" content="慕课网">
        <meta name="author" content="">
        <meta name = "format-detection" content="telephone=no">
        <meta http-equiv="Cache-Control" content="no-transform " />
        <meta http-equiv="Cache-Control" content="no-siteapp" />
        <link rel="shortcut icon" href="https://m.imooc.com/static/wap/static/favicon.ico" />
        
        
        
        <script type="text/javascript" src="https://m.imooc.com/static/wap/static/common/js/flexible.js"></script>
        
        <script type="text/javascript">
            var userInfo = "";
            
                var isApp = 0;
            
        </script>
         
<!-- 专栏首页列表模板 -->
<script type="text/template" id="index-list-tpl">
<ul class="list-con">
    {@each data.data as item}
        <li>
            <a href="/read/${item.id}" class="item clearfix">
                <div class="img l" style="background-image: url(${item.app_pic1})">
                    {@if item.is_new }
                        <div class="icon new">
                            上新
                        </div>
                    {@else if item.is_marking} 
                        <div class="icon">
                            经典
                        </div>
                    {@/if} 
                </div>
                <div class="text-con l">
                    <div class="title">
                        ${item.title}
                    </div>
                    <div class="desc">
                        ${item.chapter_num}节 · ${item.description}
                    </div>
                     <div class="user-info">
                        ${item.nickname}
                        {@if item.author_title }
                        <span class="dot">
                            ·
                        </span>
                        ${item.author_title}
                        {@/if}
                    </div>
                    <div class="info clearfix">
                    {@if !item.isBuy } 
                        <!-- 未购买才显示 -->
                        <div class="price-con l">
                        {@if item.open_discount == "1" }
                            <span class="now">￥${item.pay_price}</span>
                            <span class="ori">￥${item.price}</span>
                            <p class="sale">${item.discount_name}</p>
                        {@else}
                            <span class="now">￥${item.price}</span>
                        {@/if}
                        </div>
                    {@/if}
                        <div class="taste-con r">
                            <span>${item.numbers}人订阅</span>
                            {@if !item.isBuy }
                                <span class="gotaste">试读</span>
                            {@else}
                                <span class="gotaste">学习</span>
                            {@/if}
                        </div>
                    </div>
                </div>
            </a>
        </li>
    {@/each}
</ul>
</script>



<!-- 专栏目录 买后目录页、 -->
<script type="text/template" id="detail-catalog-tpl">
<ul class="catalog-list">
{@each data.list as item}
    <li class="zhang">
        {@if data.structure_mode == "1" }
            <!--章节模式-->
            <div class="zhang-title">
                ${item.title}（${item.count}节）
            </div>
            <div class="zhang-sub-title">
                ${item.short_introduce}
            </div>
        {@/if}  
        <ul class="zhang-detail">
            {@each item.list as it,i}
                <li class="jie">
                    {@if data.isLogin }
                        <!-- 购买了  -->
                        {@if data.isBuy }
                        <a href="javascript:;" data-link="/read/${data.column_id}/article/${it.id}" class="js-go-read">
                        {@else}
                        <a href="javascript:;" data-link="/read/${data.column_id}/article/${it.id}" class="js-go-read" >
                        {@/if}
                    {@else}
                        <!-- 未登录  -->
                        {@if data.isApp }
                            <a href="javascript:;" onclick="window.nativeSupport.login();">
                        {@else}
                            <a href="//m.imooc.com/account/login?backurl=/read/${data.column_id}">
                        {@/if}
                    {@/if}
                        <div class="jie-con {@if data.last_chapter == it.id }recent{@/if}">
                            
                            <div class="text-con">
                                <div class="jie-title">
                                    ${it.title}
                                </div>
                                <div class="jie-status">
                                    {@if it.is_open == "0" }
                                        <span class="update-time" >${it.open_time_fmt}</span>
                                    {@/if}
                                    {@if it.view_num > 100 }
                                    <div class="learn-num">
                                        <i class="imwap-set-sns"></i>
                                        <span>${it.view_num}</span>
                                    </div>
                                    {@/if}
                                    {@if it.in_24hours == "1" }
                                        <span class="update-recent">最近更新</span>
                                    {@/if}
                                </div>
                            </div>
                        </div>
                        {@if it.is_learned }
                            <div class="jie-right haslearn is_learned js-learn" data-type="1">
                                已学
                            </div>
                        {@else}
                            <!-- 购买了  -->
                            {@if data.isBuy }
                                <div class="jie-right learn js-learn" data-type="1">
                                    学习
                                </div>
                            {@else}
                                {@if it.is_pay == "0" }
                                <!--免费小节 不占用试读次数  -->
                                    <div class="jie-right learn js-learn" data-type="1">
                                        免费
                                    </div>
                                {@else}
                                    <div class="jie-right learn js-learn" data-type="0">
                                        学习
                                    </div>
                                {@/if}
                            {@/if}
                            
                            
                        {@/if}
                    </a>
                </li>
            {@/each}
        </ul>
    </li>
{@/each}
</ul>
</script> 

<!-- 阅读页 阅读页   专栏目录  -->
<script type="text/template" id="catalog-tpl">
<div>
    <h2 class="article-title">${data.a_name}</h2>
    <ul class="catalog">
    {@each data.list as item}
        <li class="zhang">
            {@if data.structure_mode == "1" }
                <!--章节模式-->
                <div class="zhang-title">
                    ${item.title}
                    <!-- <div class="num">共${item.count}节</div> -->
                </div>
            {@/if}  
            <ul class="zhang-detail">
                {@each item.list as it,i}
                    <li class="jie">
                        <!--买了且开放的-->
                        <a href="/read/${data.column_id}/article/${it.id}">
                            <div class="jie-title clearfix full">
                                <p>
                                    {@if data.last_chapter == it.id }
                                        <span class="recent">最近阅读</span>
                                    {@/if}
                                    ${it.title}
                                </p>
                            </div>
                        </a>
                    </li>
                {@/each}
            </ul>
        </li>
    {@/each}
    </ul>
</div>
</script>





<script type="text/javascript">
	var isApp = "";
	var clientVersion = "0";
	var count_num = "5";
	var chapter_id = "1908";
	var chapter_title = "12 list 源码解析：动态数组精讲";
	var aid = "76";
	var a_name = "Python 源码深度剖析";
	var a_price = "68.00";
	var a_pic = "https://img2.mukewang.com/5eb68ab400017cda05400720.jpg";
	var userId = 0;

	var column_id = '76';
	var isLogin = 0;
	

</script>
<!-- 引入字体 -->
<script type="text/javascript" src="//cdn.webfont.youziku.com/wwwroot/js/wf/youziku.api.min.js"></script>
<script type="text/javascript">
$youziku.load(".top-con .title, .cl-preview-section h1,.cl-preview-section h2,.cl-preview-section h3,.cl-preview-section h4,.cl-preview-section h5,.cl-preview-section h6", "37af461390fa4d138f5c3d277f7286dc", "SourceHanSerifSC-Heavy"); // 思源宋体heavy
$youziku.load(".lead-motto, .cl-preview-section blockquote", "d9a0d855583142c3b2cc3bf1646a8473", "SourceHanSerifSC-Regular"); // 思源宋体regular
$youziku.load("#article_content, .cl-preview-section pre, .cl-preview-section code, #code-copy", "3d84aabcf9e44b6f8c6fa91c61fa926e", "HYQiHei-55S"); // 汉仪旗黑55s
$youziku.load(".cl-preview-section strong", "fd94fff3a17546a28913a79613bddcec", "HYQiHei-77S"); // 汉仪旗黑70s

$youziku.draw();
</script>

<style type="text/css">
  header{
    display: none!important;
  }
  
  #wrapper{
  	padding-top:0px !important;
  }
  
</style>



    <link rel="stylesheet" href="https://m.imooc.com/static/wap/static/common/css/common_d42b1ef.css" /><link rel="stylesheet" href="https://m.imooc.com/static/wap/static/css/read/7.2.8/article_2d28313.css" /></head>
    <body >
        
          
        

        
          
        

        
          







<header class="directory2">
	<div class="header clearfix">
		
			
				<div class="page-title clearfix">
					<a href="//m.imooc.com" class="imwap-icon-imooc"></a>
					<div class="page-title-name js-page-name">
						<span>专栏</span>
						<i class="imwap-arrow_d"></i>
					</div>
				</div>
			

			
			<div class="drawer-box js-drawer-more">
				<i class="imwap-more_vert"></i>
				<div class="drawer-content js-drawer-content">
					<p class="line-row"></p>
					<a class="drawer-item" href="//m.imooc.com"><i class="imwap-center"></i>回到首页</a>
					<a class="drawer-item" href="//www.imooc.com/m/web/user/usercenter.html"><i class="imwap-peaple"></i>个人中心</a>
					<a class="drawer-item" href="//m.imooc.com/feedback"><i class="imwap-comment"></i>反馈问题</a>
					
					<a class="drawer-item" href="//m.imooc.com/account/login"><i class="imwap-out"></i>注册登录</a>
					
				</div>
			</div>
			

			
				<a id="js-appload" href="Javascript:;" class="app-load"><span>下载APP</span></a>
			

		
	</div>
	
	<div class="page-tab-wrap">
		<div class="page-tab-list">
			<a href="//m.imooc.com" class="page-tab-item">首页</a>
			<a href="//m.imooc.com/course/list" class="page-tab-item">课程</a>
			<a href="//coding.m.imooc.com" class="page-tab-item">实战</a>
			<a href="//class.m.imooc.com" class="page-tab-item">金职位</a>
			<a href="//m.imooc.com/article" class="page-tab-item">手记</a>
			<a href="//m.imooc.com/read" class="page-tab-item active">专栏</a>
			<a href="//m.imooc.com/wenda" class="page-tab-item">猿问</a>
			<a href="//m.imooc.com/wiki" class="page-tab-item">慕课教程</a>
			
		</div>
	</div>
	
</header>


        

        <div id="wrapper">
            <div id="middle" class="container ">

                

                
	
		
	
	<div class="top-con">
		<p class="update-time"><span>2020-05-29&nbsp;&nbsp;&nbsp;更新</span></p>
		<div class="title">
			12 list 源码解析：动态数组精讲
		</div>
	</div>
	
		<div class="article-img" style="background-image: url('https://img1.mukewang.com/5ed0687f000177ba06400426.jpg')"></div>
	
	
		<a href="/read/76">
			<div class="course-entry">
				<img src="https://img3.mukewang.com/5e4a3ec90001ef8d04000400-40-40.jpg" alt="fasionchan">
				<h3>Python 源码深度剖析</h3>
				<p>fasionchan · 资深 Python 研发工程师</p>
				<i class="imwap-arrow_r"></i>
			</div>
		</a>
	
	
		<div class="lead-motto">
			<div class="content">横眉冷对千夫指，俯首甘为孺子牛。<p class="author">——鲁迅</p></div>
		</div>
	
	
		<div class="content" id="article_content">
			
			<div class="cl-preview-section"><p><em>list</em> 对象是一种 <strong>容量自适应</strong> 的 <strong>线性容器</strong> ，底层由 <strong>动态数组</strong> 实现。动态数组结构决定了 <em>list</em> 对象具有优秀的尾部操作性能，但头部操作性能却很差劲。研发人员只有对底层数据结构有足够的认识，才能最大限度避免问题代码。</p>
</div><div class="cl-preview-section"><p>现成的动态数组实现很多，除了我们正在研究的 <em>list</em> 对象，<em>C++</em> 中的 vector 也是众所周知。虽然在实际项目中需要自行实现动态数组的场景已经很少很少了，但是源码还是有必要研究一番。源码研究不仅能加深对数据结构的理解，还能进一步提升编程水平，裨益颇多。</p>
</div><div class="cl-preview-section"><p>本节，我们开始 <em>list</em> 对象源码，深入学习 <strong>动态数组</strong> 实现的艺术。</p>
</div><div class="cl-preview-section"><h2 id="容量调整">容量调整</h2>
</div><div class="cl-preview-section"><p>当我们调用 <em>append</em> 、<em>pop</em> 、<em>insert</em> 等方法时，列表长度随之发生变化。当列表长度超过底层数组容量时，便需要对底层数组进行 <strong>扩容</strong> ；当列表长度远低于底层数组容量时，便需要对底层数组进行 <strong>缩容</strong> 。</p>
</div><div class="cl-preview-section"><p><em>Objects/listobject.c</em> 源码表明，<em>append</em> 等方法依赖 <em>list_resize</em> 函数调整列表长度，扩容缩容的秘密就藏在这里！<em>list_resize</em> 函数在调整列表长度前，先检查底层数组容量，并在必要时重新分配底层数组。接下来，我们一起来解读<em>list_resize</em> 函数，该函数同样位于源文件 <em>Objects/listobject.c</em> 中：</p>
</div><div class="cl-preview-section"><pre class="  language-c"><code class="prism  language-c"><span class="token keyword">static</span> <span class="token keyword">int</span>
<span class="token function">list_resize</span><span class="token punctuation">(</span>PyListObject <span class="token operator">*</span>self<span class="token punctuation">,</span> Py_ssize_t newsize<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    PyObject <span class="token operator">*</span><span class="token operator">*</span>items<span class="token punctuation">;</span>
    size_t new_allocated<span class="token punctuation">,</span> num_allocated_bytes<span class="token punctuation">;</span>
    Py_ssize_t allocated <span class="token operator">=</span> self<span class="token operator">-&gt;</span>allocated<span class="token punctuation">;</span>

    <span class="token comment">/* Bypass realloc() when a previous overallocation is large enough
       to accommodate the newsize.  If the newsize falls lower than half
       the allocated size, then proceed with the realloc() to shrink the list.
    */</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>allocated <span class="token operator">&gt;=</span> newsize <span class="token operator">&amp;&amp;</span> newsize <span class="token operator">&gt;=</span> <span class="token punctuation">(</span>allocated <span class="token operator">&gt;&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">assert</span><span class="token punctuation">(</span>self<span class="token operator">-&gt;</span>ob_item <span class="token operator">!=</span> <span class="token constant">NULL</span> <span class="token operator">||</span> newsize <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">Py_SIZE</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">=</span> newsize<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/* This over-allocates proportional to the list size, making room
     * for additional growth.  The over-allocation is mild, but is
     * enough to give linear-time amortized behavior over a long
     * sequence of appends() in the presence of a poorly-performing
     * system realloc().
     * The growth pattern is:  0, 4, 8, 16, 25, 35, 46, 58, 72, 88, ...
     * Note: new_allocated won't overflow because the largest possible value
     *       is PY_SSIZE_T_MAX * (9 / 8) + 6 which always fits in a size_t.
     */</span>
    new_allocated <span class="token operator">=</span> <span class="token punctuation">(</span>size_t<span class="token punctuation">)</span>newsize <span class="token operator">+</span> <span class="token punctuation">(</span>newsize <span class="token operator">&gt;&gt;</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>newsize <span class="token operator">&lt;</span> <span class="token number">9</span> <span class="token operator">?</span> <span class="token number">3</span> <span class="token punctuation">:</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>new_allocated <span class="token operator">&gt;</span> <span class="token punctuation">(</span>size_t<span class="token punctuation">)</span>PY_SSIZE_T_MAX <span class="token operator">/</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>PyObject <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">PyErr_NoMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>newsize <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
        new_allocated <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    num_allocated_bytes <span class="token operator">=</span> new_allocated <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>PyObject <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    items <span class="token operator">=</span> <span class="token punctuation">(</span>PyObject <span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">PyMem_Realloc</span><span class="token punctuation">(</span>self<span class="token operator">-&gt;</span>ob_item<span class="token punctuation">,</span> num_allocated_bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>items <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">PyErr_NoMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    self<span class="token operator">-&gt;</span>ob_item <span class="token operator">=</span> items<span class="token punctuation">;</span>
    <span class="token function">Py_SIZE</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">=</span> newsize<span class="token punctuation">;</span>
    self<span class="token operator">-&gt;</span>allocated <span class="token operator">=</span> new_allocated<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div><div class="cl-preview-section"><p>在函数开头，有几个局部变量定义，对理解函数逻辑非常关键：</p>
</div><div class="cl-preview-section"><ul>
<li><em>items</em> 指针，用于保存新数组；</li>
<li><em>new_allocated</em> ，用于保存新数组容量；</li>
<li><em>num_allocated_bytes</em> ，用于保存新数组内存大小，以字节为单位；</li>
<li><em>allocated</em> ，用于保存旧数组容量。</li>
</ul>
</div><div class="cl-preview-section"><p>然后，代码第 <em>12</em> 行，检查新长度与底层数组容量的关系。如果新长度不超过数组容量，且不小于数组容量的一半，则无需调整底层数组，直接更新 <em>ob_size</em> 字段。换句话讲， <em>list</em> 对象扩缩容的条件分别如下：</p>
</div><div class="cl-preview-section"><ul>
<li><strong>扩容条件</strong> ，新长度大于底层数组长度；</li>
<li><strong>缩容条件</strong> ，新长度小于底层数组长度的一半；</li>
</ul>
</div><div class="cl-preview-section"><p>扩容或缩容条件触发时，<em>list_resize</em> 函数根据新长度计算数组容量并重新分配底层数组（第 <em>27-44</em> 行）：</p>
</div><div class="cl-preview-section"><ol>
<li>第 <em>27</em> 行，新容量在长度加上 <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><mn>1</mn></mrow><mrow><mn>8</mn></mrow></mfrac></mrow><annotation encoding="application/x-tex">\frac{1}{8}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.845108em;"></span><span class="strut bottom" style="height: 1.19011em; vertical-align: -0.345em;"></span><span class="base"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.845108em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">8</span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line hide-tail" style="height: 0.04em;"><svg width="400em" height="400em" viewBox="0 0 400000 400000" preserveAspectRatio="xMinYMin slice"><path d="M0 0 h400000 v400000 h-400000z M0 0 h400000 v400000 h-400000z"></path></svg></span></span><span class="" style="top: -3.394em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.345em;"></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span>  的裕量，再加上 <em>3</em> 或 <em>6</em> 的裕量；</li>
<li>第 <em>28-31</em> 行，如果新容量超过允许范围，返回错误；</li>
<li>第 <em>33-34</em> 行，如果新长度为 <em>0</em> ，将新容量也设置为 <em>0</em> ，因此空列表底层数组亦为空；</li>
<li>第 <em>36-40</em> 行，调用 <em>PyMem_Realloc</em> 函数重新分配底层数组；</li>
<li>第 <em>41-44</em> 行，更新 <em>3</em> 个关键字段，依次设置为 <strong>新底层数组</strong> 、 <strong>新长度</strong> 以及 <strong>新容量</strong> 。</li>
</ol>
</div><div class="cl-preview-section"><p>注意到代码第 27 行，新容量的计算公式有点令人费解。为什么还要加上 <em>3</em> 或者 <em>6</em> 的裕量呢？试想一下，如果新长度小于 <em>8</em> ，那么 <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><mn>1</mn></mrow><mrow><mn>8</mn></mrow></mfrac></mrow><annotation encoding="application/x-tex">\frac{1}{8}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.845108em;"></span><span class="strut bottom" style="height: 1.19011em; vertical-align: -0.345em;"></span><span class="base"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.845108em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">8</span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line hide-tail" style="height: 0.04em;"><svg width="400em" height="400em" viewBox="0 0 400000 400000" preserveAspectRatio="xMinYMin slice"><path d="M0 0 h400000 v400000 h-400000z M0 0 h400000 v400000 h-400000z"></path></svg></span></span><span class="" style="top: -3.394em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.345em;"></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span>  的裕量便是 <em>0</em> ！这意味着，当 <em>list</em> 对象长度从 <em>0</em> 开始增长时，需要频繁扩容！</p>
</div><div class="cl-preview-section"><p>为了解决这个问题，必须在 <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><mn>1</mn></mrow><mrow><mn>8</mn></mrow></mfrac></mrow><annotation encoding="application/x-tex">\frac{1}{8}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.845108em;"></span><span class="strut bottom" style="height: 1.19011em; vertical-align: -0.345em;"></span><span class="base"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.845108em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">8</span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line hide-tail" style="height: 0.04em;"><svg width="400em" height="400em" viewBox="0 0 400000 400000" preserveAspectRatio="xMinYMin slice"><path d="M0 0 h400000 v400000 h-400000z M0 0 h400000 v400000 h-400000z"></path></svg></span></span><span class="" style="top: -3.394em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.345em;"></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span>  裕量的基础上额外加上一定的固定裕量。而 <em>3</em> 和 <em>6</em> 这两个特殊数值的选择，使得列表容量按照 <em>0</em>、<em>4</em>、<em>8</em>、 16、<em>25</em>、<em>35</em>、<em>46</em>、<em>58</em>、<em>72</em>、<em>88</em>……这样的序列进行扩张。这样一来，当 <em>list</em> 对象长度较小时，容量翻倍扩展，扩容频率得到有效限制。</p>
</div><div class="cl-preview-section"><p>顺便提一下， <em>PyMem_Realloc</em> 函数是 <em>Python</em> 内部实现的内存管理函数之一，功能与 <em>C</em> 库函数 <em>realloc</em> 类似：</p>
</div><div class="cl-preview-section"><pre class="  language-c"><code class="prism  language-c"><span class="token function">PyAPI_FUNC</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span> <span class="token function">PyMem_Realloc</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>ptr<span class="token punctuation">,</span> size_t new_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
</div><div class="cl-preview-section"><p><em>PyMem_Realloc</em> 函数用于对动态内存进行扩容或者缩容，关键步骤如下：</p>
</div><div class="cl-preview-section"><ol>
<li>新申请一块尺寸为 <em>new_size</em> 的内存区域；</li>
<li>将数据从旧内存区域 <em>ptr</em> 拷贝到新内存区域；</li>
<li>释放旧内存区域 <em>ptr</em> ；</li>
<li>返回新内存区域。</li>
</ol>
</div><div class="cl-preview-section"><p><img src="https://img.mukewang.com/5ed06b0c00011f0218640499.png" alt="图片描述"></p>
</div><div class="cl-preview-section"><p><strong>内存管理</strong> 是最考验研发人员编程功底的领域之一，鼓励大家到 <em>PyMem_Realloc</em> 源码（<em>./Objects/obmalloc.c</em>）中进一步研究内存管理的技巧。学有余力的童鞋，可模仿着自己实现一个 <em>realloc</em> 函数，假以时日编程内功将突飞猛进！</p>
</div><div class="cl-preview-section"><h2 id="尾部追加">尾部追加</h2>
</div><div class="cl-preview-section"><p><em>append</em> 方法在 <em>Python</em> 内部由 <em>C</em> 函数 <em>list_append</em> 实现，而 <em>list_append</em> 进一步调用 <em>app1</em> 函数完成元素追加：</p>
</div><div class="cl-preview-section"><pre class="  language-c"><code class="prism  language-c"><span class="token keyword">static</span> <span class="token keyword">int</span>
<span class="token function">app1</span><span class="token punctuation">(</span>PyListObject <span class="token operator">*</span>self<span class="token punctuation">,</span> PyObject <span class="token operator">*</span>v<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    Py_ssize_t n <span class="token operator">=</span> <span class="token function">PyList_GET_SIZE</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">assert</span> <span class="token punctuation">(</span>v <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">==</span> PY_SSIZE_T_MAX<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">PyErr_SetString</span><span class="token punctuation">(</span>PyExc_OverflowError<span class="token punctuation">,</span>
            <span class="token string">"cannot add more objects to list"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">list_resize</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> n<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>

    <span class="token function">Py_INCREF</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">PyList_SET_ITEM</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> n<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div><div class="cl-preview-section"><ol>
<li>第 <em>4</em> 行，调用 <em>PyList_GET_SIZE</em> 取出列表长度，即 <em>ob_size</em> 字段；</li>
<li>第 <em>7-11</em> 行，判断列表当前长度，如果已经达到最大限制，则报错；</li>
<li>第 <em>13-15</em> 行，调用 <em>list_resize</em> 更新列表长度，必要时 <em>list_resize</em> 对底层数组进行 <strong>扩容</strong> ；</li>
<li>第 <em>16</em> 行，自增元素对象 <strong>引用计数</strong> (元素对象新增一个来自列表对象的引用)；</li>
<li>第 17 行，将元素对象指针保存到列表最后一个位置，列表新长度为 <em>n+1</em> ，最后一个位置下标为 <em>n</em> 。</li>
</ol>
</div><div class="cl-preview-section"><p>我们看到，有了 <em>list_resize</em> 这个辅助函数后， <em>app1</em> 函数的实现就非常直白了。接下来，我们将看到 <em>insert</em>、<em>pop</em> 等方法的实现中也用到这个函数，从中可体会到程序逻辑 <strong>划分</strong> 、 <strong>组合</strong> 的巧妙之处。</p>
</div><div class="cl-preview-section"><h2 id="头部插入">头部插入</h2>
</div><div class="cl-preview-section"><p><em>insert</em> 方法在 <em>Python</em> 内部由 <em>C</em> 函数 <em>list_insert_impl</em> 实现，而 <em>list_insert_impl</em> 则调用 <em>ins1</em> 函数完成元素插入：</p>
</div><div class="cl-preview-section"><pre class="  language-c"><code class="prism  language-c"><span class="token keyword">static</span> <span class="token keyword">int</span>
<span class="token function">ins1</span><span class="token punctuation">(</span>PyListObject <span class="token operator">*</span>self<span class="token punctuation">,</span> Py_ssize_t where<span class="token punctuation">,</span> PyObject <span class="token operator">*</span>v<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    Py_ssize_t i<span class="token punctuation">,</span> n <span class="token operator">=</span> <span class="token function">Py_SIZE</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">;</span>
    PyObject <span class="token operator">*</span><span class="token operator">*</span>items<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>v <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">PyErr_BadInternalCall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">==</span> PY_SSIZE_T_MAX<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">PyErr_SetString</span><span class="token punctuation">(</span>PyExc_OverflowError<span class="token punctuation">,</span>
            <span class="token string">"cannot add more objects to list"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">list_resize</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> n<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>where <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        where <span class="token operator">+</span><span class="token operator">=</span> n<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>where <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
            where <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>where <span class="token operator">&gt;</span> n<span class="token punctuation">)</span>
        where <span class="token operator">=</span> n<span class="token punctuation">;</span>
    items <span class="token operator">=</span> self<span class="token operator">-&gt;</span>ob_item<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> n<span class="token punctuation">;</span> <span class="token operator">--</span>i <span class="token operator">&gt;=</span> where<span class="token punctuation">;</span> <span class="token punctuation">)</span>
        items<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> items<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">Py_INCREF</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    items<span class="token punctuation">[</span>where<span class="token punctuation">]</span> <span class="token operator">=</span> v<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div><div class="cl-preview-section"><ol>
<li>第 <em>4</em> 行，调用 <em>PyList_GET_SIZE</em> 取出列表长度，即 <em>ob_size</em> 字段；</li>
<li>第 <em>10-14</em> 行，判断列表当前长度，如果已经达到最大限制，则报错；</li>
<li>第 <em>16-17</em> 行，调用 <em>list_resize</em> 更新列表长度，必要时 <em>list_resize</em> 对底层数组进行 <strong>扩容</strong> ；</li>
<li>第 <em>19-23</em> 行，检查插入位置下标，如果下标为负数，加上 <em>n</em> 将其转换为非负数；</li>
<li>第 <em>21-22</em>、<em>24-25</em> 行，检查插入位置下标是否越界，如果越界则设为开头或结尾；</li>
<li>第 <em>26-28</em> 行，将插入位置以后的所有元素逐一往后移一个位置，特别注意 <em>for</em> 循环必须 <strong>从后往前</strong> 迭代；</li>
<li>第 <em>29</em> 行，自增元素对象 <strong>引用计数</strong> (元素对象新增一个来自列表对象的引用)；</li>
<li>第 <em>30</em> 行，将元素对象指针保存到列表指定位置。</li>
</ol>
</div><div class="cl-preview-section"><p><em>Python</em> 序列 <strong>下标很有特色</strong> ，除了支持 <em>0~n-1</em> 这样的惯例外，还支持 <strong>倒数下标</strong> 。倒数下标为负数，从后往前数：最后一个元素为 <em>-1</em> ，倒数第二个为 <em>-2</em> ；以此类推，第一个元素下标为： <em>-n</em> 。</p>
</div><div class="cl-preview-section"><p><img src="https://img.mukewang.com/5ed06af70001203305490163.png" alt="图片描述"></p>
</div><div class="cl-preview-section"><p>倒数下标非常实用，可以很方便地取出序列最后几个元素，而不用关心序列的长度。 <em>Python</em> 内部处理倒数下标时，自动为其加上长度序列 <em>n</em> ，便转化成普通下标了。</p>
</div><div class="cl-preview-section"><h2 id="弹出元素">弹出元素</h2>
</div><div class="cl-preview-section"><p><em>pop</em> 方法将指定下标的元素从列表中弹出，下标默认为 <em>-1</em> 。换句话讲，如果未指定下标，<em>pop</em> 弹出最后一个元素：</p>
</div><div class="cl-preview-section"><pre class="  language-python"><code class="prism  language-python"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token builtin">help</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">.</span>pop<span class="token punctuation">)</span>
Help on method_descriptor<span class="token punctuation">:</span>

pop<span class="token punctuation">(</span>self<span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">/</span><span class="token punctuation">)</span>
    Remove <span class="token operator">and</span> <span class="token keyword">return</span> item at index <span class="token punctuation">(</span>default last<span class="token punctuation">)</span><span class="token punctuation">.</span>

    Raises IndexError <span class="token keyword">if</span> <span class="token builtin">list</span> <span class="token keyword">is</span> empty <span class="token operator">or</span> index <span class="token keyword">is</span> out of <span class="token builtin">range</span><span class="token punctuation">.</span>
</code></pre>
</div><div class="cl-preview-section"><p><em>pop</em> 方法在 <em>Python</em> 内部由 <em>C</em> 函数 <em>list_pop_impl</em> 实现：</p>
</div><div class="cl-preview-section"><pre class="  language-c"><code class="prism  language-c"><span class="token keyword">static</span> PyObject <span class="token operator">*</span>
<span class="token function">list_pop_impl</span><span class="token punctuation">(</span>PyListObject <span class="token operator">*</span>self<span class="token punctuation">,</span> Py_ssize_t index<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    PyObject <span class="token operator">*</span>v<span class="token punctuation">;</span>
    <span class="token keyword">int</span> status<span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">Py_SIZE</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">/* Special-case most common failure cause */</span>
        <span class="token function">PyErr_SetString</span><span class="token punctuation">(</span>PyExc_IndexError<span class="token punctuation">,</span> <span class="token string">"pop from empty list"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
        index <span class="token operator">+</span><span class="token operator">=</span> <span class="token function">Py_SIZE</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> index <span class="token operator">&gt;=</span> <span class="token function">Py_SIZE</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">PyErr_SetString</span><span class="token punctuation">(</span>PyExc_IndexError<span class="token punctuation">,</span> <span class="token string">"pop index out of range"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    v <span class="token operator">=</span> self<span class="token operator">-&gt;</span>ob_item<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">==</span> <span class="token function">Py_SIZE</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        status <span class="token operator">=</span> <span class="token function">list_resize</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token function">Py_SIZE</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>status <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> v<span class="token punctuation">;</span> <span class="token comment">/* and v now owns the reference the list had */</span>
        <span class="token keyword">else</span>
            <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">Py_INCREF</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    status <span class="token operator">=</span> <span class="token function">list_ass_slice</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> index<span class="token punctuation">,</span> index<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>PyObject <span class="token operator">*</span><span class="token punctuation">)</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>status <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">Py_DECREF</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> v<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div><div class="cl-preview-section"><ol>
<li>第 <em>7-11</em> 行，如果列表为空，没有任何元素可弹出，抛出 <em>IndexError</em> 异常；</li>
<li>第 <em>12-13</em> 行，如果给定下标为 <strong>倒数下标</strong> ，先加上列表长度，将其转换成普通下标；</li>
<li>第 <em>14-16</em> 行，检查给定下标是否在合法范围内，超出合法范围同样抛出 <em>IndexError</em> 异常；</li>
<li>第 <em>18</em> 行，从底层数组中取出待弹出元素；</li>
<li>第 <em>19-25</em> 行，如果待弹出元素为列表最后一个，调用 <em>list_resize</em> 快速调整列表长度即可，无需移动其他元素；</li>
<li>第 <em>26-31</em> 行，其他情况下调用 <em>list_ass_slice</em> 函数删除元素，调用前需要通过 <em>Py_INCREF</em> 增加元素引用计数，因为 <em>list_ass_slice</em> 函数内部将释放被删除元素；</li>
<li>第 32 行，将待弹出元素返回。</li>
</ol>
</div><div class="cl-preview-section"><p><em>list_ass_slice</em> 函数其实有两种不同的语义，具体执行哪种语义由函数参数决定，函数接口如下：</p>
</div><div class="cl-preview-section"><pre class="  language-c"><code class="prism  language-c"><span class="token comment">/* a[ilow:ihigh] = v if v != NULL.
 * del a[ilow:ihigh] if v == NULL.
 *
 * Special speed gimmick:  when v is NULL and ihigh - ilow &lt;= 8, it's
 * guaranteed the call cannot fail.
 */</span>
<span class="token keyword">static</span> <span class="token keyword">int</span>
<span class="token function">list_ass_slice</span><span class="token punctuation">(</span>PyListObject <span class="token operator">*</span>a<span class="token punctuation">,</span> Py_ssize_t ilow<span class="token punctuation">,</span> Py_ssize_t ihigh<span class="token punctuation">,</span> PyObject <span class="token operator">*</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
</div><div class="cl-preview-section"><ul>
<li><strong>删除语义</strong> ，如果最后一个参数 <em>v</em> 值为 <em>NULL</em> ，执行删除语义，即：<em>del a[ilow:ihigh]</em> ；</li>
<li><strong>替换语义</strong> ，如果最后一个参数 <em>v</em> 值不为 <em>NULL</em> ，执行替换语义，即 <em>a[ilow:ihigh] = v</em> 。</li>
</ul>
</div><div class="cl-preview-section"><p>因此，代码第 <em>27</em> 行中， <em>list_ass_slice</em> 函数执行删除语义，将 <em>[index, index+1)</em> 范围内的元素删除。由于半开半闭区间 <em>[index, index+1)</em> 中只包含 <em>index</em> 一个元素，效果等同于将下标为 <em>index</em> 的元素删除。</p>
</div><div class="cl-preview-section"><p>执行删除语义时， <em>list_ass_slice</em> 函数将被删元素后面的元素逐一往前移动，以便重新覆盖删除操作所造成的空隙。由此可见，<em>pop</em> 方法弹出元素，时间复杂度跟弹出位置有关：</p>
</div><div class="cl-preview-section"><ul>
<li>最好时间复杂度( <strong>尾部弹出</strong> )，<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mn>1</mn><mo>)</mo></mrow><annotation encoding="application/x-tex">O(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.75em;"></span><span class="strut bottom" style="height: 1em; vertical-align: -0.25em;"></span><span class="base"><span class="mord mathit" style="margin-right: 0.02778em;">O</span><span class="mopen">(</span><span class="mord mathrm">1</span><span class="mclose">)</span></span></span></span></span> ；</li>
<li>最坏时间复杂度( <strong>头部弹出</strong> )，<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">O(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.75em;"></span><span class="strut bottom" style="height: 1em; vertical-align: -0.25em;"></span><span class="base"><span class="mord mathit" style="margin-right: 0.02778em;">O</span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mclose">)</span></span></span></span></span>；</li>
<li>平均时间复杂度， <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mfrac><mrow><mi>n</mi></mrow><mrow><mn>2</mn></mrow></mfrac><mo>)</mo></mrow><annotation encoding="application/x-tex">O(\frac{n}{2})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.75em;"></span><span class="strut bottom" style="height: 1.095em; vertical-align: -0.345em;"></span><span class="base"><span class="mord mathit" style="margin-right: 0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.695392em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">2</span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line hide-tail" style="height: 0.04em;"><svg width="400em" height="400em" viewBox="0 0 400000 400000" preserveAspectRatio="xMinYMin slice"><path d="M0 0 h400000 v400000 h-400000z M0 0 h400000 v400000 h-400000z"></path></svg></span></span><span class="" style="top: -3.394em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.345em;"></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">)</span></span></span></span></span> ，亦即 <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">O(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.75em;"></span><span class="strut bottom" style="height: 1em; vertical-align: -0.25em;"></span><span class="base"><span class="mord mathit" style="margin-right: 0.02778em;">O</span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mclose">)</span></span></span></span></span> 。</li>
</ul>
</div><div class="cl-preview-section"><p><img src="https://img.mukewang.com/5ed06aea0001e95509950309.png" alt="图片描述"></p>
</div><div class="cl-preview-section"><p>因此，调用 <em>pop</em> 方法弹出非尾部元素时，需要非常谨慎。</p>
</div><div class="cl-preview-section"><h2 id="删除元素">删除元素</h2>
</div><div class="cl-preview-section"><p><em>remove</em> 方法将给定元素从列表中删除。与 <em>pop</em> 略微不同，<em>remove</em> 方法直接给定待删除元素，而不是元素下标。<em>remove</em> 方法在 <em>Python</em> 内部由 <em>C</em> 函数 <em>list_remove</em> 实现：</p>
</div><div class="cl-preview-section"><pre class="  language-c"><code class="prism  language-c"><span class="token keyword">static</span> PyObject <span class="token operator">*</span>
<span class="token function">list_remove</span><span class="token punctuation">(</span>PyListObject <span class="token operator">*</span>self<span class="token punctuation">,</span> PyObject <span class="token operator">*</span>value<span class="token punctuation">)</span>
<span class="token comment">/*[clinic end generated code: output=f087e1951a5e30d1 input=2dc2ba5bb2fb1f82]*/</span>
<span class="token punctuation">{</span>
    Py_ssize_t i<span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token function">Py_SIZE</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> cmp <span class="token operator">=</span> <span class="token function">PyObject_RichCompareBool</span><span class="token punctuation">(</span>self<span class="token operator">-&gt;</span>ob_item<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> value<span class="token punctuation">,</span> Py_EQ<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>cmp <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">list_ass_slice</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> i<span class="token punctuation">,</span> i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>
                               <span class="token punctuation">(</span>PyObject <span class="token operator">*</span><span class="token punctuation">)</span><span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
                Py_RETURN_NONE<span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>cmp <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">PyErr_SetString</span><span class="token punctuation">(</span>PyExc_ValueError<span class="token punctuation">,</span> <span class="token string">"list.remove(x): x not in list"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div><div class="cl-preview-section"><p><em>list_remove</em> 函数先遍历列表中每个元素（第 <em>7</em> 行），检查元素是否为待删除元素 <em>value</em> （第 <em>8</em> 行），以此确定下标。然后， <em>list_remove</em> 函数调用 <em>list_ass_slice</em> 函数进行删除。注意到，如果给定元素不存在， <em>list_remove</em> 将抛出 <em>ValueError</em> 异常。</p>
</div><div class="cl-preview-section"><p>由此可见，<em>remove</em> 方法在删除前有一个时间复杂度为 <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">O(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.75em;"></span><span class="strut bottom" style="height: 1em; vertical-align: -0.25em;"></span><span class="base"><span class="mord mathit" style="margin-right: 0.02778em;">O</span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mclose">)</span></span></span></span></span> 的查找过程，性能不甚理想，须谨慎使用。</p>
</div><div class="cl-preview-section"><h2 id="小结">小结</h2>
</div><div class="cl-preview-section"><p><em>list</em> 对象是一种 <strong>容量自适应</strong> 的 <strong>线性容器</strong> ，底层由 <strong>动态数组</strong> 实现。<em>Python</em> 内部由函数 <em>list_resize</em> 调整列表长度， <em>list_resize</em> 自动为列表进行 <strong>扩容</strong> 或者 <strong>缩容</strong> ：</p>
</div><div class="cl-preview-section"><ul>
<li>底层数组容量不够时，需要进行 <strong>扩容</strong> ；</li>
<li>扩容时， <em>Python</em> 额外分配大约 <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn><mi mathvariant="normal">/</mi><mn>8</mn></mrow><annotation encoding="application/x-tex">1/8</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.75em;"></span><span class="strut bottom" style="height: 1em; vertical-align: -0.25em;"></span><span class="base"><span class="mord mathrm">1</span><span class="mord mathrm">/</span><span class="mord mathrm">8</span></span></span></span></span> 的容量裕量，以控制扩容频率；</li>
<li>底层数组空闲���置超过一半时，需要进行 <strong>缩容</strong> 。</li>
</ul>
</div><div class="cl-preview-section"><p>动态数组的特性决定了 <em>list</em> 对象相关操作性能有好有坏，使用时须特别留意：</p>
</div><div class="cl-preview-section"><ul>
<li><em>append</em> 向尾部追加元素，时间复杂度为 <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mn>1</mn><mo>)</mo></mrow><annotation encoding="application/x-tex">O(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.75em;"></span><span class="strut bottom" style="height: 1em; vertical-align: -0.25em;"></span><span class="base"><span class="mord mathit" style="margin-right: 0.02778em;">O</span><span class="mopen">(</span><span class="mord mathrm">1</span><span class="mclose">)</span></span></span></span></span> ，放心使用；</li>
<li><em>insert</em> 往列表插入元素，最坏时间复杂度是 <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">O(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.75em;"></span><span class="strut bottom" style="height: 1em; vertical-align: -0.25em;"></span><span class="base"><span class="mord mathit" style="margin-right: 0.02778em;">O</span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mclose">)</span></span></span></span></span> ，平均时间复杂度也是  <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">O(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.75em;"></span><span class="strut bottom" style="height: 1em; vertical-align: -0.25em;"></span><span class="base"><span class="mord mathit" style="margin-right: 0.02778em;">O</span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mclose">)</span></span></span></span></span>，须谨慎使用；</li>
<li><em>pop</em> 从列表中弹出元素，最好时间复杂度为 <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mn>1</mn><mo>)</mo></mrow><annotation encoding="application/x-tex">O(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.75em;"></span><span class="strut bottom" style="height: 1em; vertical-align: -0.25em;"></span><span class="base"><span class="mord mathit" style="margin-right: 0.02778em;">O</span><span class="mopen">(</span><span class="mord mathrm">1</span><span class="mclose">)</span></span></span></span></span> ，平均时间复杂度为 <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">O(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.75em;"></span><span class="strut bottom" style="height: 1em; vertical-align: -0.25em;"></span><span class="base"><span class="mord mathit" style="margin-right: 0.02778em;">O</span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mclose">)</span></span></span></span></span> ，弹出非尾部元素时需谨慎；</li>
<li><em>remove</em> 从列表中删除元素，时间复杂度为 <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">O(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.75em;"></span><span class="strut bottom" style="height: 1em; vertical-align: -0.25em;"></span><span class="base"><span class="mord mathit" style="margin-right: 0.02778em;">O</span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mclose">)</span></span></span></span></span>，同样须谨慎使用。</li>
</ul>
</div>
			
		</div>
	
	
	<div class="finish-learn">
		<p class="copyright">©版权归慕课网所有，未经许可不得转载</p>
		
		
		
		<div class="ad_pic">
			<img src="https://img.mukewang.com/5ed0688400011d7f06700192.jpg">
		</div>
		
		
		
		
	</div>
	<div class="comment-con">
		<h4 class="title">
			精选留言
			
				<a href="javascript: void(0);" class="add-comment js-comment-click"><i class="imwap-xieliuyan"></i><span>写留言</span></a>
			
		</h4>
		
			<ul class="comment-content">
				
				<li class="item">
					<a href="/read/commentdetail/6896">
						<img src="https://img3.mukewang.com/5b8cd5000001a08502000197-100-100.jpg" alt="" class="avatar">
						<h4 class="nickname">qq_慕尼黑1236838</h4>
						<div class="comment-text">老师，怎么从python使用的方法找到c中对应的哪个函数呢？这条路径怎么找？比如list中的append方法是怎么对应c中的list_append？</div>
						<div>
							
						</div>
					</a>
					<p class="bottom">
						<span class="l">2020-10-01</span>
						<a href="/read/commentdetail/6896">
							<span class="icon r"><i class="imwap-comment"></i><em>1</em></span>
						</a>
						<span data-cid="6896" class="icon r js-comment-upvote "><i class="imwap-thumb_up"></i><em>0</em></span>
					</p>
				</li>
				
				<li class="item">
					<a href="/read/commentdetail/5999">
						<img src="https://img2.mukewang.com/5b8cf1810001c0b302000200-100-100.jpg" alt="" class="avatar">
						<h4 class="nickname">weixin_精慕门5533881</h4>
						<div class="comment-text">def tet_size():
    a = []
    print((sys.getsizeof(a)))
    for i in range(1, 20):
        a.append(i)
        size_ = (sys.getsizeof(a))
        print('打印第%s次添加元素的大小为%s' % (str(i), str(size_)))
打印的结果：
72
打印第1次添加元素的大小为104
打印第2次添加元素的大小为104
打印第3次添加元素的大小为104
打印第4次添加元素的大小为104
打印第5次添加元素的大小为136
打印第6次添加元素的大小为136
打印第7次添加元素的大小为136
打印第8次添加元素的大小为136
打印第9次添加元素的大小为200
打印第10次添加元素的大小为200
打印第11次添加元素的大小为200
打印第12次添加元素的大小为200
打印第13次添加元素的大小为200
....
从打印的结果看空列表的大小为72字节，allocated为0，
添加一个数据1时候，列表大小为104字节，allocated = 4，难道是每一个小数组存储的是8字节数据，但是C语言中指针大小为4字节，这里比较疑惑；
添加数据到5时候，列表中大小为136字节，allocated = 8，136 = 72 + 8*8 是这样算？</div>
						<div>
							
								<div class="reply">讲师回复：C语言中指针大小跟系统位数有关，在32位系统为4字节，在64位系统为8字节。现在的操作系统，绝大部分都是64位了，32位比较少见。</div>
							
						</div>
					</a>
					<p class="bottom">
						<span class="l">2020-07-01</span>
						<a href="/read/commentdetail/5999">
							<span class="icon r"><i class="imwap-comment"></i><em>1</em></span>
						</a>
						<span data-cid="5999" class="icon r js-comment-upvote "><i class="imwap-thumb_up"></i><em>0</em></span>
					</p>
				</li>
				
				<li class="item">
					<a href="/read/commentdetail/5984">
						<img src="https://img3.mukewang.com/54584e390001972002200220-100-100.jpg" alt="" class="avatar">
						<h4 class="nickname">慕莱坞2377110</h4>
						<div class="comment-text">请问那种方式来删除list对象里面的元素可以放心使用？</div>
						<div>
							
								<div class="reply">讲师回复：list对象提供的删除方法都是安全的，都可以放心使用，但效率因素需要视情况加以考虑。在列表长度不大的场景，O(n)的删除操作也是可以接受的；而在列表长度较大时，则需谨慎。</div>
							
						</div>
					</a>
					<p class="bottom">
						<span class="l">2020-06-30</span>
						<a href="/read/commentdetail/5984">
							<span class="icon r"><i class="imwap-comment"></i><em>4</em></span>
						</a>
						<span data-cid="5984" class="icon r js-comment-upvote "><i class="imwap-thumb_up"></i><em>0</em></span>
					</p>
				</li>
				
				<li class="item">
					<a href="/read/commentdetail/5954">
						<img src="https://img.mukewang.com/56a34ce5000116bc01000100-100-100.jpg" alt="" class="avatar">
						<h4 class="nickname">妄言九天</h4>
						<div class="comment-text">老师，有一个地方并不了解，想请教一下。
在list_remove源码中，为什么
else if (cmp < 0)
            return NULL;
这里如果cmp值小于0的时候，是直接return NULL而没有删除过程呢？
另外这个cmp返回值含义什么？</div>
						<div>
							
								<div class="reply">讲师回复：①cmp&amp;gt;0，表示找到了要删除的对象，这时调用list_ass_slice进行删除；
②cmp&amp;lt;0，表示元素比较出错，这时返回NULL表示出错，PyObject_RichCompareBool已经设置了错误信息，正常情况下，list_remove应该返回None对象，即           Py_RETURN_NONE;；③如果没有找到要删除的元素，设置错误并返回NULL表示出错，这样Python会抛出异常。</div>
							
						</div>
					</a>
					<p class="bottom">
						<span class="l">2020-06-28</span>
						<a href="/read/commentdetail/5954">
							<span class="icon r"><i class="imwap-comment"></i><em>2</em></span>
						</a>
						<span data-cid="5954" class="icon r js-comment-upvote "><i class="imwap-thumb_up"></i><em>0</em></span>
					</p>
				</li>
				
				<li class="item">
					<a href="/read/commentdetail/5952">
						<img src="https://img3.mukewang.com/56a34ce5000116bc01000100-100-100.jpg" alt="" class="avatar">
						<h4 class="nickname">妄言九天</h4>
						<div class="comment-text">for (i = n; --i >= where; )
        items[i+1] = items[i];
老师，我看代码中有这样一段，看把自减计算也放在for第二个位置，这个方法比起放在第三个位置有什么优点吗？
亦或这个只是个人的编写习惯?</div>
						<div>
							
								<div class="reply">讲师回复：① for (i=n; --i&amp;gt;=where;)

② for (i=n-1; i&amp;gt;=where; --i)

③ i=n-1; while(i&amp;gt;=where) { --i; }

这几个循环逻辑上是等价的，执行效率没什么区别，①和②更直观一点。其中，①是最紧凑的，但牺牲了一点可读性。具体选择哪种方法，主要看个人喜好，除可读性外，没有优劣之分。</div>
							
						</div>
					</a>
					<p class="bottom">
						<span class="l">2020-06-28</span>
						<a href="/read/commentdetail/5952">
							<span class="icon r"><i class="imwap-comment"></i><em>1</em></span>
						</a>
						<span data-cid="5952" class="icon r js-comment-upvote "><i class="imwap-thumb_up"></i><em>0</em></span>
					</p>
				</li>
				
			</ul>
			
		
	</div>
	
	

	
		
	
	
	
		<div class="bottom-con">
			
			
				<div class="inner">
					
						<div class="price-con js-price-con">
							<span class="now">￥68.00</span>
						</div>
							
					
					
					<a class="gobuy js-gobuy" href="//m.imooc.com/account/login?backurl=//m.imooc.com/confirmorder?type=30&typeid=76">
					
						立即购买
					</a>  
				</div>
			
		</div>
	
	<div class="layer-catalog js-layer-catalog hide">
		<div class="layer-title clearfix">
			<div class="l">
				课程目录
			</div>
			
		</div>
		<div class="layer-wrap">
			<div class="js-catalog-container">
			</div>
		</div>
	</div>
	<div class="layer-comment">
		<div class="inner">
			<h5>
				<span class="btn l js-cancel-comment">取消</span>
				评论
				<span class="btn r js-send-comment">发送</span>
			</h5>
			<textarea id="comment-txt" maxlength="20000" placeholder="欢迎在这里发表留言，作者筛选后可公开显示"></textarea>
		</div>
	</div>


            </div>
        </div>
        
            
         
        
        
        
        




<script>
	// 设置字号大小及选中
	(function() {
			var fs = window.localStorage.getItem('font-size') || 'normal';
			var $c = document.querySelector('#middle>.content');
			var $points = document.querySelectorAll('.setting-box .point');
			try{
				// 抢读完了时 该元素不渲染 会有报错
				$c.className = 'content ' + fs;
				for(var i = 0; i < $points.length; i++) {
					if($points[i].className.indexOf(fs) > -1) {
						$points[i].className = $points[i].className + ' current';
					}
				}
			} catch(e) {}
			
	})();
</script>

<script type="text/javascript">
	window.onload = function() {
			zhuge.track('LearnCourse', {
					'Category': '专栏',
					'Name': '12 list 源码解析：动态数组精讲',
					'CID': '1908',
					'Teacher': 'fasionchan'
			});
	}
</script>

        
            <script type="text/javascript">
                var shareData = { 
                    title:  "12 list 源码解析：动态数组精讲",
                    desc: "突破技术瓶颈，迈向更高岗位",
                    imgUrl: 'https:https://img2.mukewang.com/5eb68ab400017cda05400720.jpg',
                    otherImgUrl: 'https://img2.mukewang.com/5eb68ab400017cda05400720.jpg',
                    text: '我正在参加@慕课网的课程，很不错哦！快来一起学习吧！',
                    // url: 'https://www.imooc.com' + window.location.pathname + window.location.search
                    url: 'https://m.imooc.com/read/76',
                    link: 'https://m.imooc.com/read/76'
                }
            </script>
            
        
        <div style="display:none;">
            <!-- 百度统计 -->
            <script>
            var _hmt = _hmt || [];
            (function() {
              var hm = document.createElement("script");
              hm.src = "https://hm.baidu.com/hm.js?c92536284537e1806a07ef3e6873f2b3";
              var s = document.getElementsByTagName("script")[0];
              s.parentNode.insertBefore(hm, s);
            })();
            </script>

            <script>
            (function(){
                var bp = document.createElement('script');
                var curProtocol = window.location.protocol.split(':')[0];
                if (curProtocol === 'https') {
                    bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
                }
                else {
                    bp.src = 'http://push.zhanzhang.baidu.com/push.js';
                }
                var s = document.getElementsByTagName("script")[0];
                s.parentNode.insertBefore(bp, s);
            })();
            </script>
        </div>
        
    <script type="text/javascript" src="https://m.imooc.com/static/wap/static/lib/zhugeio/init_f9752c3.js"></script><script type="text/javascript" src="https://m.imooc.com/static/wap/static/common/js/jquery-2.1.0.min_ac9f840.js"></script><script type="text/javascript" src="https://m.imooc.com/static/wap/static/common/js/common_84429c0.js"></script><script type="text/javascript" src="https://m.imooc.com/static/wap/static/lib/juicer/juicer.min_8643248.js"></script><script type="text/javascript" src="https://m.imooc.com/static/wap/static/lib/previewImage/previewImage.min_43b970d.js"></script><script type="text/javascript" src="https://m.imooc.com/static/wap/static/common/js/msg_bed8d10.js"></script><script type="text/javascript" src="https://m.imooc.com/static/wap/static/js/read/7.2.8/article_30e5762.js"></script><script type="text/javascript" src="https://m.imooc.com/static/wap/static/js/course/advertisementReport_6e58a98.js"></script></body>
</html>
